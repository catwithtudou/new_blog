
# 09-12

## 9. 重新组织数据

### 9.1 拆分变量（Split Variable）

![](https://img.zhengyua.cn/blog/202406060911871.png)

- **自然被多次赋值**

变量有各种不同的用途，其中某些用途会很自然地导致临时变量被多次赋值。

- **承担多个责任的变量**

如果变量承担多个责任，它就应该被替换（分解）为多个变量，每个变量只承担一个责任。同一个变量承担两件不同的事情，会令代码阅读者糊涂。

??? note "具体重构步骤"

	1. 在待分解变量的声明及其第一次被赋值处，修改其名称；

	> 如果稍后的赋值语句是“i=i+某表达式形式”，意味着这是一个结果收集变量，就不要分解它。结果收集变量常用于累加、字符串拼接、写入流或者向集合添加元素。

	2. 如果可能的话，将新的变量声明为不可修改；
	3. 以该变量的第二次赋值动作为界，修改此前对该变量的所有引用，让它们引用新变量；
	4. 测试；
	5. 重复上述过程。每次都在声明处对变量改名，并修改下次赋值之前的引用，直至到达最后一处赋值；

### 9.2 字段改名（Rename Field）

![](https://img.zhengyua.cn/blog/202406060914069.png)

- **重要的命名**

命名很重要，对于程序中广泛使用的记录结构，其中字段的命名格外重要。数据结构对于帮助阅读者理解特别重要。

- **保持数据结构的整洁**

既然数据结构如此重要，就很有必要保持它们的整洁。一如既往地，若在一个软件上做的工作越多，对数据的理解就越深，所以很有必要把我加深的理解融入程序中。

??? note "具体重构步骤"

	1. 如果记录的作用域较小，可以直接修改所有该字段的代码，然后测试。后面的步骤就都不需要了；
	2. 如果记录还未封装，请先使用封装记录；
	3. 在对象内部对私有字段改名，对应调整内部访问该字段的函数；
	4. 测试；
	5. 如果构造函数的参数用了旧的字段名，运用改变函数声明将其改名；
	6. 运用函数改名给访问函数改名；

### 9.3 以查询取代派生变量（Replace Derived Variable with Query）

??? note "具体重构步骤"

### 9.4 将引用对象改为值对象（Change Reference to Value）
### 9.5 将值对象改为引用对象（Change Value to Reference）

## 10. 简化条件逻辑

## 11. 重构 API

## 12. 处理继承关系