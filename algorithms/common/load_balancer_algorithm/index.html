
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Life">
      
      
        <meta name="author" content="catwithtudouï¸">
      
      
        <link rel="canonical" href="https://zhengyua.cn/new_blog/algorithms/common/load_balancer_algorithm/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../../../os/">
      
      
      <link rel="icon" href="../../../assets/logo.jpeg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>æ·±å…¥ç†è§£å››ç§ç»å…¸è´Ÿè½½å‡è¡¡ç®—æ³• - catwithtudouï¸ğŸŒ¦ï¸</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-WZVK8HDP5T"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-WZVK8HDP5T",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-WZVK8HDP5T",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#æ·±å…¥ç†è§£å››ç§ç»å…¸è´Ÿè½½å‡è¡¡ç®—æ³•" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="catwithtudouï¸ğŸŒ¦ï¸" class="md-header__button md-logo" aria-label="catwithtudouï¸ğŸŒ¦ï¸" data-md-component="logo">
      
  <img src="../../../assets/logo.jpeg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            catwithtudouï¸ğŸŒ¦ï¸
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              æ·±å…¥ç†è§£å››ç§ç»å…¸è´Ÿè½½å‡è¡¡ç®—æ³•
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/catwithtudou" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    catwithtudou
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  ğŸŒ¦ï¸Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../blog/" class="md-tabs__link">
          
  
    
  
  ğŸ“ŒMainPage

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../language/" class="md-tabs__link">
          
  
    
  
  Language

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
    
  
  Algorithms

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../os/" class="md-tabs__link">
          
  
    
  
  OS

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../network/" class="md-tabs__link">
          
  
    
  
  Network

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../ds/" class="md-tabs__link">
          
  
    
  
  DS

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../architecture/" class="md-tabs__link">
          
  
    
  
  Architecture

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../middleware/" class="md-tabs__link">
          
  
    
  
  Middleware

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../project/" class="md-tabs__link">
          
  
    
  
  Project

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../common/01-100_tips/" class="md-tabs__link">
          
  
    
  
  Common

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="catwithtudouï¸ğŸŒ¦ï¸" class="md-nav__button md-logo" aria-label="catwithtudouï¸ğŸŒ¦ï¸" data-md-component="logo">
      
  <img src="../../../assets/logo.jpeg" alt="logo">

    </a>
    catwithtudouï¸ğŸŒ¦ï¸
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/catwithtudou" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    catwithtudou
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ğŸŒ¦ï¸Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../blog/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    ğŸ“ŒMainPage
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../language/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Language
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Algorithms
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Algorithms
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../LLM/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    LLM
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_2" id="__nav_4_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            LLM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
          
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../LLM/inbox/2412_prompt_begin/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    inbox
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../books/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    books
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_3" id="__nav_4_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            books
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../books/2401%E4%BB%A3%E7%A0%81%E9%9A%8F%E6%83%B3%E5%BD%95/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    2401ä»£ç éšæƒ³å½•
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    common
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_4" id="__nav_4_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            common
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    æ·±å…¥ç†è§£å››ç§ç»å…¸è´Ÿè½½å‡è¡¡ç®—æ³•
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    æ·±å…¥ç†è§£å››ç§ç»å…¸è´Ÿè½½å‡è¡¡ç®—æ³•
    
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#0-èƒŒæ™¯ä»‹ç»" class="md-nav__link">
    <span class="md-ellipsis">
      0. èƒŒæ™¯ä»‹ç»
    </span>
  </a>
  
    <nav class="md-nav" aria-label="0. èƒŒæ™¯ä»‹ç»">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡" class="md-nav__link">
    <span class="md-ellipsis">
      ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#è´Ÿè½½å‡è¡¡åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„é‡è¦æ€§" class="md-nav__link">
    <span class="md-ellipsis">
      è´Ÿè½½å‡è¡¡åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„é‡è¦æ€§
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ç®—æ³•å®ç°çš„åŸºç¡€ç»“æ„" class="md-nav__link">
    <span class="md-ellipsis">
      ç®—æ³•å®ç°çš„åŸºç¡€ç»“æ„
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-éšæœºé€‰æ‹©ç®—æ³•-" class="md-nav__link">
    <span class="md-ellipsis">
      1. éšæœºé€‰æ‹©ç®—æ³• ğŸ²
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. éšæœºé€‰æ‹©ç®—æ³• ğŸ²">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ç®—æ³•åŸç†" class="md-nav__link">
    <span class="md-ellipsis">
      ç®—æ³•åŸç†
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”" class="md-nav__link">
    <span class="md-ellipsis">
      å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ ¸å¿ƒå®ç°" class="md-nav__link">
    <span class="md-ellipsis">
      æ ¸å¿ƒå®ç°
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä¼˜ç¼ºç‚¹åˆ†æ" class="md-nav__link">
    <span class="md-ellipsis">
      ä¼˜ç¼ºç‚¹åˆ†æ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-è½®è¯¢ç®—æ³•-" class="md-nav__link">
    <span class="md-ellipsis">
      2. è½®è¯¢ç®—æ³• ğŸ”„
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. è½®è¯¢ç®—æ³• ğŸ”„">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ç®—æ³•åŸç†_1" class="md-nav__link">
    <span class="md-ellipsis">
      ç®—æ³•åŸç†
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”_1" class="md-nav__link">
    <span class="md-ellipsis">
      å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ ¸å¿ƒå®ç°_1" class="md-nav__link">
    <span class="md-ellipsis">
      æ ¸å¿ƒå®ç°
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å¹³æ»‘åŠ æƒè½®è¯¢è¯¦è§£" class="md-nav__link">
    <span class="md-ellipsis">
      å¹³æ»‘åŠ æƒè½®è¯¢è¯¦è§£
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä¼˜ç¼ºç‚¹åˆ†æ_1" class="md-nav__link">
    <span class="md-ellipsis">
      ä¼˜ç¼ºç‚¹åˆ†æ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-æœ€å°è¿æ¥ç®—æ³•-" class="md-nav__link">
    <span class="md-ellipsis">
      3. æœ€å°è¿æ¥ç®—æ³• ğŸ”Œ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. æœ€å°è¿æ¥ç®—æ³• ğŸ”Œ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ç®—æ³•åŸç†_2" class="md-nav__link">
    <span class="md-ellipsis">
      ç®—æ³•åŸç†
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”_2" class="md-nav__link">
    <span class="md-ellipsis">
      å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ ¸å¿ƒå®ç°_2" class="md-nav__link">
    <span class="md-ellipsis">
      æ ¸å¿ƒå®ç°
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä¼˜ç¼ºç‚¹åˆ†æ_2" class="md-nav__link">
    <span class="md-ellipsis">
      ä¼˜ç¼ºç‚¹åˆ†æ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-maglev-ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•-" class="md-nav__link">
    <span class="md-ellipsis">
      4. Maglev ä¸€è‡´æ€§å“ˆå¸Œç®—æ³• ğŸ§²
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Maglev ä¸€è‡´æ€§å“ˆå¸Œç®—æ³• ğŸ§²">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ç®—æ³•åŸç†_3" class="md-nav__link">
    <span class="md-ellipsis">
      ç®—æ³•åŸç†
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”_3" class="md-nav__link">
    <span class="md-ellipsis">
      å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ ¸å¿ƒå®ç°_3" class="md-nav__link">
    <span class="md-ellipsis">
      æ ¸å¿ƒå®ç°
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä¼˜ç¼ºç‚¹åˆ†æ_3" class="md-nav__link">
    <span class="md-ellipsis">
      ä¼˜ç¼ºç‚¹åˆ†æ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-ç®—æ³•å¯¹æ¯”ä¸å®è·µå»ºè®®-" class="md-nav__link">
    <span class="md-ellipsis">
      5. ç®—æ³•å¯¹æ¯”ä¸å®è·µå»ºè®® ğŸ“Š
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. ç®—æ³•å¯¹æ¯”ä¸å®è·µå»ºè®® ğŸ“Š">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#å››ç§ç®—æ³•å¯¹æ¯”-" class="md-nav__link">
    <span class="md-ellipsis">
      å››ç§ç®—æ³•å¯¹æ¯” ğŸ”
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å®è·µå»ºè®®-" class="md-nav__link">
    <span class="md-ellipsis">
      å®è·µå»ºè®® ğŸ› ï¸
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#çœŸå®ä¸–ç•Œåº”ç”¨æ¡ˆä¾‹-" class="md-nav__link">
    <span class="md-ellipsis">
      çœŸå®ä¸–ç•Œåº”ç”¨æ¡ˆä¾‹ ğŸŒ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="çœŸå®ä¸–ç•Œåº”ç”¨æ¡ˆä¾‹ ğŸŒ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#æ¡ˆä¾‹1cdnè¾¹ç¼˜èŠ‚ç‚¹è°ƒåº¦" class="md-nav__link">
    <span class="md-ellipsis">
      æ¡ˆä¾‹1ï¼šCDNè¾¹ç¼˜èŠ‚ç‚¹è°ƒåº¦
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ¡ˆä¾‹2apiç½‘å…³" class="md-nav__link">
    <span class="md-ellipsis">
      æ¡ˆä¾‹2ï¼šAPIç½‘å…³
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ¡ˆä¾‹3æ•°æ®åº“è¯»å†™åˆ†ç¦»" class="md-nav__link">
    <span class="md-ellipsis">
      æ¡ˆä¾‹3ï¼šæ•°æ®åº“è¯»å†™åˆ†ç¦»
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ¡ˆä¾‹4åˆ†å¸ƒå¼ç¼“å­˜é›†ç¾¤" class="md-nav__link">
    <span class="md-ellipsis">
      æ¡ˆä¾‹4ï¼šåˆ†å¸ƒå¼ç¼“å­˜é›†ç¾¤
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-è´Ÿè½½å‡è¡¡çš„ç†è®ºåŸºç¡€ä¸æœªæ¥å‘å±•-" class="md-nav__link">
    <span class="md-ellipsis">
      6. è´Ÿè½½å‡è¡¡çš„ç†è®ºåŸºç¡€ä¸æœªæ¥å‘å±• ğŸ§®
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. è´Ÿè½½å‡è¡¡çš„ç†è®ºåŸºç¡€ä¸æœªæ¥å‘å±• ğŸ§®">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#è´Ÿè½½å‡è¡¡çš„ç†è®ºåŸºç¡€" class="md-nav__link">
    <span class="md-ellipsis">
      è´Ÿè½½å‡è¡¡çš„ç†è®ºåŸºç¡€
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#è´Ÿè½½å‡è¡¡æŠ€æœ¯çš„æ–°è¶‹åŠ¿" class="md-nav__link">
    <span class="md-ellipsis">
      è´Ÿè½½å‡è¡¡æŠ€æœ¯çš„æ–°è¶‹åŠ¿
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#è·¨é¢†åŸŸå¯ç¤º" class="md-nav__link">
    <span class="md-ellipsis">
      è·¨é¢†åŸŸå¯ç¤º
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-æ€»ç»“-" class="md-nav__link">
    <span class="md-ellipsis">
      7. æ€»ç»“ ğŸ“
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-å‚è€ƒ" class="md-nav__link">
    <span class="md-ellipsis">
      8. å‚è€ƒ
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../os/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    OS
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../network/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Network
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../ds/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    DS
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../architecture/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../middleware/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Middleware
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../project/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Project
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../common/01-100_tips/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Common
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#0-èƒŒæ™¯ä»‹ç»" class="md-nav__link">
    <span class="md-ellipsis">
      0. èƒŒæ™¯ä»‹ç»
    </span>
  </a>
  
    <nav class="md-nav" aria-label="0. èƒŒæ™¯ä»‹ç»">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡" class="md-nav__link">
    <span class="md-ellipsis">
      ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#è´Ÿè½½å‡è¡¡åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„é‡è¦æ€§" class="md-nav__link">
    <span class="md-ellipsis">
      è´Ÿè½½å‡è¡¡åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„é‡è¦æ€§
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ç®—æ³•å®ç°çš„åŸºç¡€ç»“æ„" class="md-nav__link">
    <span class="md-ellipsis">
      ç®—æ³•å®ç°çš„åŸºç¡€ç»“æ„
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-éšæœºé€‰æ‹©ç®—æ³•-" class="md-nav__link">
    <span class="md-ellipsis">
      1. éšæœºé€‰æ‹©ç®—æ³• ğŸ²
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. éšæœºé€‰æ‹©ç®—æ³• ğŸ²">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ç®—æ³•åŸç†" class="md-nav__link">
    <span class="md-ellipsis">
      ç®—æ³•åŸç†
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”" class="md-nav__link">
    <span class="md-ellipsis">
      å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ ¸å¿ƒå®ç°" class="md-nav__link">
    <span class="md-ellipsis">
      æ ¸å¿ƒå®ç°
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä¼˜ç¼ºç‚¹åˆ†æ" class="md-nav__link">
    <span class="md-ellipsis">
      ä¼˜ç¼ºç‚¹åˆ†æ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-è½®è¯¢ç®—æ³•-" class="md-nav__link">
    <span class="md-ellipsis">
      2. è½®è¯¢ç®—æ³• ğŸ”„
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. è½®è¯¢ç®—æ³• ğŸ”„">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ç®—æ³•åŸç†_1" class="md-nav__link">
    <span class="md-ellipsis">
      ç®—æ³•åŸç†
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”_1" class="md-nav__link">
    <span class="md-ellipsis">
      å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ ¸å¿ƒå®ç°_1" class="md-nav__link">
    <span class="md-ellipsis">
      æ ¸å¿ƒå®ç°
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å¹³æ»‘åŠ æƒè½®è¯¢è¯¦è§£" class="md-nav__link">
    <span class="md-ellipsis">
      å¹³æ»‘åŠ æƒè½®è¯¢è¯¦è§£
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä¼˜ç¼ºç‚¹åˆ†æ_1" class="md-nav__link">
    <span class="md-ellipsis">
      ä¼˜ç¼ºç‚¹åˆ†æ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-æœ€å°è¿æ¥ç®—æ³•-" class="md-nav__link">
    <span class="md-ellipsis">
      3. æœ€å°è¿æ¥ç®—æ³• ğŸ”Œ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. æœ€å°è¿æ¥ç®—æ³• ğŸ”Œ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ç®—æ³•åŸç†_2" class="md-nav__link">
    <span class="md-ellipsis">
      ç®—æ³•åŸç†
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”_2" class="md-nav__link">
    <span class="md-ellipsis">
      å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ ¸å¿ƒå®ç°_2" class="md-nav__link">
    <span class="md-ellipsis">
      æ ¸å¿ƒå®ç°
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä¼˜ç¼ºç‚¹åˆ†æ_2" class="md-nav__link">
    <span class="md-ellipsis">
      ä¼˜ç¼ºç‚¹åˆ†æ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-maglev-ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•-" class="md-nav__link">
    <span class="md-ellipsis">
      4. Maglev ä¸€è‡´æ€§å“ˆå¸Œç®—æ³• ğŸ§²
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Maglev ä¸€è‡´æ€§å“ˆå¸Œç®—æ³• ğŸ§²">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ç®—æ³•åŸç†_3" class="md-nav__link">
    <span class="md-ellipsis">
      ç®—æ³•åŸç†
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”_3" class="md-nav__link">
    <span class="md-ellipsis">
      å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ ¸å¿ƒå®ç°_3" class="md-nav__link">
    <span class="md-ellipsis">
      æ ¸å¿ƒå®ç°
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä¼˜ç¼ºç‚¹åˆ†æ_3" class="md-nav__link">
    <span class="md-ellipsis">
      ä¼˜ç¼ºç‚¹åˆ†æ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-ç®—æ³•å¯¹æ¯”ä¸å®è·µå»ºè®®-" class="md-nav__link">
    <span class="md-ellipsis">
      5. ç®—æ³•å¯¹æ¯”ä¸å®è·µå»ºè®® ğŸ“Š
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. ç®—æ³•å¯¹æ¯”ä¸å®è·µå»ºè®® ğŸ“Š">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#å››ç§ç®—æ³•å¯¹æ¯”-" class="md-nav__link">
    <span class="md-ellipsis">
      å››ç§ç®—æ³•å¯¹æ¯” ğŸ”
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å®è·µå»ºè®®-" class="md-nav__link">
    <span class="md-ellipsis">
      å®è·µå»ºè®® ğŸ› ï¸
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#çœŸå®ä¸–ç•Œåº”ç”¨æ¡ˆä¾‹-" class="md-nav__link">
    <span class="md-ellipsis">
      çœŸå®ä¸–ç•Œåº”ç”¨æ¡ˆä¾‹ ğŸŒ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="çœŸå®ä¸–ç•Œåº”ç”¨æ¡ˆä¾‹ ğŸŒ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#æ¡ˆä¾‹1cdnè¾¹ç¼˜èŠ‚ç‚¹è°ƒåº¦" class="md-nav__link">
    <span class="md-ellipsis">
      æ¡ˆä¾‹1ï¼šCDNè¾¹ç¼˜èŠ‚ç‚¹è°ƒåº¦
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ¡ˆä¾‹2apiç½‘å…³" class="md-nav__link">
    <span class="md-ellipsis">
      æ¡ˆä¾‹2ï¼šAPIç½‘å…³
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ¡ˆä¾‹3æ•°æ®åº“è¯»å†™åˆ†ç¦»" class="md-nav__link">
    <span class="md-ellipsis">
      æ¡ˆä¾‹3ï¼šæ•°æ®åº“è¯»å†™åˆ†ç¦»
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ¡ˆä¾‹4åˆ†å¸ƒå¼ç¼“å­˜é›†ç¾¤" class="md-nav__link">
    <span class="md-ellipsis">
      æ¡ˆä¾‹4ï¼šåˆ†å¸ƒå¼ç¼“å­˜é›†ç¾¤
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-è´Ÿè½½å‡è¡¡çš„ç†è®ºåŸºç¡€ä¸æœªæ¥å‘å±•-" class="md-nav__link">
    <span class="md-ellipsis">
      6. è´Ÿè½½å‡è¡¡çš„ç†è®ºåŸºç¡€ä¸æœªæ¥å‘å±• ğŸ§®
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. è´Ÿè½½å‡è¡¡çš„ç†è®ºåŸºç¡€ä¸æœªæ¥å‘å±• ğŸ§®">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#è´Ÿè½½å‡è¡¡çš„ç†è®ºåŸºç¡€" class="md-nav__link">
    <span class="md-ellipsis">
      è´Ÿè½½å‡è¡¡çš„ç†è®ºåŸºç¡€
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#è´Ÿè½½å‡è¡¡æŠ€æœ¯çš„æ–°è¶‹åŠ¿" class="md-nav__link">
    <span class="md-ellipsis">
      è´Ÿè½½å‡è¡¡æŠ€æœ¯çš„æ–°è¶‹åŠ¿
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#è·¨é¢†åŸŸå¯ç¤º" class="md-nav__link">
    <span class="md-ellipsis">
      è·¨é¢†åŸŸå¯ç¤º
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-æ€»ç»“-" class="md-nav__link">
    <span class="md-ellipsis">
      7. æ€»ç»“ ğŸ“
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-å‚è€ƒ" class="md-nav__link">
    <span class="md-ellipsis">
      8. å‚è€ƒ
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="æ·±å…¥ç†è§£å››ç§ç»å…¸è´Ÿè½½å‡è¡¡ç®—æ³•">æ·±å…¥ç†è§£å››ç§ç»å…¸è´Ÿè½½å‡è¡¡ç®—æ³•<a class="headerlink" href="#æ·±å…¥ç†è§£å››ç§ç»å…¸è´Ÿè½½å‡è¡¡ç®—æ³•" title="Permanent link">&para;</a></h1>
<h2 id="0-èƒŒæ™¯ä»‹ç»">0. èƒŒæ™¯ä»‹ç»<a class="headerlink" href="#0-èƒŒæ™¯ä»‹ç»" title="Permanent link">&para;</a></h2>
<h3 id="ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡">ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡<a class="headerlink" href="#ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡" title="Permanent link">&para;</a></h3>
<p>è´Ÿè½½å‡è¡¡ï¼ˆLoad Balancingï¼‰æ˜¯ä¸€ç§è®¡ç®—æœºç½‘ç»œæŠ€æœ¯ï¼Œç”¨äºåœ¨å¤šä¸ªè®¡ç®—æœºã€ç½‘ç»œè¿æ¥ã€CPUã€ç£ç›˜é©±åŠ¨å™¨æˆ–å…¶ä»–èµ„æºä¸­åˆ†é…è´Ÿè½½ï¼Œä¼˜åŒ–èµ„æºä½¿ç”¨ï¼Œæœ€å¤§åŒ–ååé‡ï¼Œæœ€å°åŒ–å“åº”æ—¶é—´ï¼Œé¿å…è¿‡è½½ã€‚ä½¿ç”¨å¤šä¸ªç»„ä»¶è¿›è¡Œè´Ÿè½½åˆ†æ‹…ï¼Œç›¸æ¯”ä½¿ç”¨å•ä¸ªç»„ä»¶ï¼Œå¯ä»¥é€šè¿‡å†—ä½™æé«˜å¯é æ€§å’Œå¯ç”¨æ€§ã€‚</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><a href="#__codelineno-0-1"><span class="linenos" data-linenos=" 1 "></span></a>                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><a href="#__codelineno-0-2"><span class="linenos" data-linenos=" 2 "></span></a>                    â”‚ è´Ÿè½½å‡è¡¡å™¨  â”‚
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><a href="#__codelineno-0-3"><span class="linenos" data-linenos=" 3 "></span></a>                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><a href="#__codelineno-0-4"><span class="linenos" data-linenos=" 4 "></span></a>                           â”‚
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><a href="#__codelineno-0-5"><span class="linenos" data-linenos=" 5 "></span></a>                           â–¼
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><a href="#__codelineno-0-6"><span class="linenos" data-linenos=" 6 "></span></a>          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><a href="#__codelineno-0-7"><span class="linenos" data-linenos=" 7 "></span></a>          â”‚                             â”‚
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><a href="#__codelineno-0-8"><span class="linenos" data-linenos=" 8 "></span></a>    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><a href="#__codelineno-0-9"><span class="linenos" data-linenos=" 9 "></span></a>    â”‚           â”‚             â”‚               â”‚
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><a href="#__codelineno-0-10"><span class="linenos" data-linenos="10 "></span></a>â”Œâ”€â”€â”€â–¼â”€â”€â”€â”   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”     â”Œâ”€â”€â”€â–¼â”€â”€â”€â”       â”Œâ”€â”€â”€â–¼â”€â”€â”€â”
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><a href="#__codelineno-0-11"><span class="linenos" data-linenos="11 "></span></a>â”‚æœåŠ¡å™¨1 â”‚   â”‚æœåŠ¡å™¨2 â”‚     â”‚æœåŠ¡å™¨3 â”‚       â”‚æœåŠ¡å™¨4 â”‚
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><a href="#__codelineno-0-12"><span class="linenos" data-linenos="12 "></span></a>â””â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>
<h3 id="è´Ÿè½½å‡è¡¡åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„é‡è¦æ€§">è´Ÿè½½å‡è¡¡åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„é‡è¦æ€§<a class="headerlink" href="#è´Ÿè½½å‡è¡¡åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„é‡è¦æ€§" title="Permanent link">&para;</a></h3>
<p>åœ¨ç°ä»£åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ä¸­ï¼Œè´Ÿè½½å‡è¡¡æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ï¼š</p>
<ol>
<li><strong>æé«˜ç³»ç»Ÿå¯ç”¨æ€§</strong> ğŸ”„ - å½“å•ä¸ªæœåŠ¡å™¨å‘ç”Ÿæ•…éšœæ—¶ï¼Œè¯·æ±‚å¯ä»¥è‡ªåŠ¨è·¯ç”±åˆ°å…¶ä»–å¥åº·çš„æœåŠ¡å™¨</li>
<li><strong>æå‡ç³»ç»Ÿæ‰©å±•æ€§</strong> ğŸ” - éšç€æµé‡å¢åŠ ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ æ–°çš„æœåŠ¡å™¨èŠ‚ç‚¹æ¥æ°´å¹³æ‰©å±•ç³»ç»Ÿ</li>
<li><strong>ä¼˜åŒ–èµ„æºåˆ©ç”¨ç‡</strong> ğŸ’¯ - ç¡®ä¿å„ä¸ªæœåŠ¡å™¨çš„è´Ÿè½½ç›¸å¯¹å‡è¡¡ï¼Œé¿å…éƒ¨åˆ†æœåŠ¡å™¨è¿‡è½½è€Œå…¶ä»–æœåŠ¡å™¨é—²ç½®</li>
<li><strong>æä¾›ç¾éš¾æ¢å¤èƒ½åŠ›</strong> ğŸ›Ÿ - åœ¨åŒºåŸŸæ€§æ•…éšœæ—¶å¯ä»¥å°†æµé‡è½¬ç§»åˆ°ä¸åŒåœ°åŒºçš„æœåŠ¡å™¨</li>
<li><strong>ä¾¿äºç³»ç»Ÿç»´æŠ¤</strong> ğŸ”§ - å…è®¸åœ¨ä¸å½±å“ç”¨æˆ·ä½“éªŒçš„æƒ…å†µä¸‹å¯¹å•ä¸ªæœåŠ¡å™¨è¿›è¡Œç»´æŠ¤æˆ–å‡çº§</li>
</ol>
<p>åœ¨å¤§å‹äº’è”ç½‘ç³»ç»Ÿä¸­ï¼Œè´Ÿè½½å‡è¡¡é€šå¸¸ä»¥å¤šçº§æ–¹å¼å®ç°ï¼ŒåŒ…æ‹¬DNSè´Ÿè½½å‡è¡¡ã€ç½‘ç»œå±‚(L4)è´Ÿè½½å‡è¡¡å’Œåº”ç”¨å±‚(L7)è´Ÿè½½å‡è¡¡ã€‚è€Œåœ¨è¿™äº›è´Ÿè½½å‡è¡¡è§£å†³æ–¹æ¡ˆçš„æ ¸å¿ƒï¼Œéƒ½éœ€è¦ä¸€ä¸ªé«˜æ•ˆã€é€‚åˆå…·ä½“åœºæ™¯çš„è´Ÿè½½å‡è¡¡ç®—æ³•ã€‚</p>
<h3 id="ç®—æ³•å®ç°çš„åŸºç¡€ç»“æ„">ç®—æ³•å®ç°çš„åŸºç¡€ç»“æ„<a class="headerlink" href="#ç®—æ³•å®ç°çš„åŸºç¡€ç»“æ„" title="Permanent link">&para;</a></h3>
<p>åœ¨æ·±å…¥å„ä¸ªç®—æ³•å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹è¿™äº›ç®—æ³•çš„å…±åŒåŸºç¡€ç»“æ„ï¼š</p>
<div class="language-go highlight"><span class="filename">Go</span><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><a href="#__codelineno-1-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="c1">// Server è¡¨ç¤ºä¸€ä¸ªåç«¯æœåŠ¡å™¨</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><a href="#__codelineno-1-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kd">type</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><a href="#__codelineno-1-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w">    </span><span class="nx">Address</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><a href="#__codelineno-1-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">    </span><span class="nx">Weight</span><span class="w">  </span><span class="kt">int</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><a href="#__codelineno-1-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">    </span><span class="c1">// ç”¨äºæœ€å°è¿æ¥ç®—æ³•çš„å½“å‰è¿æ¥æ•°</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><a href="#__codelineno-1-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span><span class="nx">CurrentConnections</span><span class="w"> </span><span class="kt">int32</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><a href="#__codelineno-1-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span><span class="c1">// ç”¨äºè½®è¯¢ç®—æ³•çš„å½“å‰æƒé‡</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><a href="#__codelineno-1-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">    </span><span class="nx">CurrentWeight</span><span class="w"> </span><span class="kt">int</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><a href="#__codelineno-1-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="w">    </span><span class="c1">// ç”¨äºè½®è¯¢ç®—æ³•çš„æœ‰æ•ˆæƒé‡</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><a href="#__codelineno-1-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">    </span><span class="nx">EffectiveWeight</span><span class="w"> </span><span class="kt">int</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><a href="#__codelineno-1-11"><span class="linenos" data-linenos="11 "></span></a><span class="p">}</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a><a href="#__codelineno-1-12"><span class="linenos" data-linenos="12 "></span></a>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><a href="#__codelineno-1-13"><span class="linenos" data-linenos="13 "></span></a><span class="c1">// LoadBalancer å®šä¹‰è´Ÿè½½å‡è¡¡å™¨æ¥å£</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><a href="#__codelineno-1-14"><span class="linenos" data-linenos="14 "></span></a><span class="kd">type</span><span class="w"> </span><span class="nx">LoadBalancer</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a><a href="#__codelineno-1-15"><span class="linenos" data-linenos="15 "></span></a><span class="w">    </span><span class="c1">// AddServer æ·»åŠ æœåŠ¡å™¨</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a><a href="#__codelineno-1-16"><span class="linenos" data-linenos="16 "></span></a><span class="w">    </span><span class="nx">AddServer</span><span class="p">(</span><span class="nx">server</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a><a href="#__codelineno-1-17"><span class="linenos" data-linenos="17 "></span></a><span class="w">    </span><span class="c1">// RemoveServer ç§»é™¤æœåŠ¡å™¨</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a><a href="#__codelineno-1-18"><span class="linenos" data-linenos="18 "></span></a><span class="w">    </span><span class="nx">RemoveServer</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a><a href="#__codelineno-1-19"><span class="linenos" data-linenos="19 "></span></a><span class="w">    </span><span class="c1">// GetServer è·å–ä¸‹ä¸€ä¸ªæœåŠ¡å™¨</span>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a><a href="#__codelineno-1-20"><span class="linenos" data-linenos="20 "></span></a><span class="w">    </span><span class="nx">GetServer</span><span class="p">(</span><span class="nx">key</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a><a href="#__codelineno-1-21"><span class="linenos" data-linenos="21 "></span></a><span class="p">}</span>
</code></pre></div>
<p>æ‰€æœ‰çš„è´Ÿè½½å‡è¡¡ç®—æ³•éƒ½å®ç°äº†è¿™ä¸ªæ¥å£ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥ç”¨ç»Ÿä¸€çš„æ–¹å¼è°ƒç”¨ä¸åŒçš„è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚é€šè¿‡è¿™ç§è®¾è®¡ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åˆ‡æ¢ä¸åŒçš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œè€Œæ— éœ€ä¿®æ”¹è°ƒç”¨ä»£ç ã€‚</p>
<h2 id="1-éšæœºé€‰æ‹©ç®—æ³•-">1. éšæœºé€‰æ‹©ç®—æ³• ğŸ²<a class="headerlink" href="#1-éšæœºé€‰æ‹©ç®—æ³•-" title="Permanent link">&para;</a></h2>
<h3 id="ç®—æ³•åŸç†">ç®—æ³•åŸç†<a class="headerlink" href="#ç®—æ³•åŸç†" title="Permanent link">&para;</a></h3>
<p>éšæœºé€‰æ‹©æ˜¯æœ€ç®€å•çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå®ƒ<strong>éšæœº</strong>ä»å¯ç”¨æœåŠ¡å™¨æ± ä¸­é€‰æ‹©ä¸€ä¸ªæœåŠ¡å™¨å¤„ç†è¯·æ±‚ã€‚</p>
<ul>
<li><strong>æ™®é€šéšæœº</strong>ï¼šæ¯ä¸ªæœåŠ¡å™¨è¢«é€‰ä¸­çš„æ¦‚ç‡ç›¸ç­‰</li>
<li><strong>åŠ æƒéšæœº</strong>ï¼šæƒé‡å¤§çš„æœåŠ¡å™¨è¢«é€‰ä¸­çš„æ¦‚ç‡æ›´é«˜</li>
</ul>
<p><strong>éšæœºç®—æ³•æµç¨‹å›¾</strong>ï¼š</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><a href="#__codelineno-2-1"><span class="linenos" data-linenos=" 1 "></span></a>å¼€å§‹
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><a href="#__codelineno-2-2"><span class="linenos" data-linenos=" 2 "></span></a>  â†“
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><a href="#__codelineno-2-3"><span class="linenos" data-linenos=" 3 "></span></a>è¿‡æ»¤å‡ºæƒé‡&gt;0çš„å¯ç”¨æœåŠ¡å™¨
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><a href="#__codelineno-2-4"><span class="linenos" data-linenos=" 4 "></span></a>  â†“
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><a href="#__codelineno-2-5"><span class="linenos" data-linenos=" 5 "></span></a>è®¡ç®—æ‰€æœ‰å¯ç”¨æœåŠ¡å™¨çš„æ€»æƒé‡
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><a href="#__codelineno-2-6"><span class="linenos" data-linenos=" 6 "></span></a>  â†“
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><a href="#__codelineno-2-7"><span class="linenos" data-linenos=" 7 "></span></a>åœ¨[0,æ€»æƒé‡)èŒƒå›´å†…éšæœºé€‰æ‹©ä¸€ä¸ªå€¼
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><a href="#__codelineno-2-8"><span class="linenos" data-linenos=" 8 "></span></a>  â†“
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><a href="#__codelineno-2-9"><span class="linenos" data-linenos=" 9 "></span></a>éå†æœåŠ¡å™¨åˆ—è¡¨ï¼Œå½“ç´¯è®¡æƒé‡è¶…è¿‡éšæœºå€¼æ—¶é€‰ä¸­è¯¥æœåŠ¡å™¨
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><a href="#__codelineno-2-10"><span class="linenos" data-linenos="10 "></span></a>  â†“
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><a href="#__codelineno-2-11"><span class="linenos" data-linenos="11 "></span></a>è¿”å›è¢«é€‰ä¸­çš„æœåŠ¡å™¨
<a id="__codelineno-2-12" name="__codelineno-2-12"></a><a href="#__codelineno-2-12"><span class="linenos" data-linenos="12 "></span></a>  â†“
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><a href="#__codelineno-2-13"><span class="linenos" data-linenos="13 "></span></a>ç»“æŸ
</code></pre></div>
<h3 id="å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”">å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”<a class="headerlink" href="#å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”" title="Permanent link">&para;</a></h3>
<p>éšæœºé€‰æ‹©ç®—æ³•æœ¬è´¨ä¸Šæ˜¯<strong>åŠ æƒéšæœºæŠ½æ ·é—®é¢˜</strong>çš„ä¸€ä¸ªå®é™…åº”ç”¨ã€‚è¿™ç±»é—®é¢˜åœ¨å¤šä¸ªé¢†åŸŸéƒ½æœ‰å¹¿æ³›åº”ç”¨ï¼š</p>
<ol>
<li><strong>è½®ç›˜èµŒé€‰æ‹©(Roulette Wheel Selection)</strong>ï¼šåœ¨é—ä¼ ç®—æ³•ä¸­ï¼Œç”¨äºæŒ‰é€‚åº”åº¦æ¯”ä¾‹é€‰æ‹©ä¸ªä½“è¿›è¡Œç¹æ®–</li>
<li><strong>å¸¦æƒé‡çš„éšæœºæ•°ç”Ÿæˆå™¨</strong>ï¼šæ ¹æ®ä¸åŒæ¦‚ç‡ç”Ÿæˆéšæœºæ•°</li>
<li><strong>è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿ(Monte Carlo Simulation)</strong>ï¼šé€šè¿‡éšæœºæŠ½æ ·ä¼°è®¡æ¦‚ç‡åˆ†å¸ƒ</li>
</ol>
<p><strong>ç±»æ¯”æ€è·¯</strong>ï¼šå‡è®¾æ‚¨æœ‰ä¸€ä¸ªè½®ç›˜ï¼Œæ¯ä¸ªæœåŠ¡å™¨åœ¨è½®ç›˜ä¸Šå æ®ä¸€å®šè§’åº¦ï¼ˆä¸å…¶æƒé‡æˆæ­£æ¯”ï¼‰ã€‚è½¬åŠ¨è½®ç›˜ï¼Œå°çƒè½åœ¨å“ªä¸ªåŒºåŸŸï¼Œå°±é€‰æ‹©å“ªä¸ªæœåŠ¡å™¨ã€‚æƒé‡è¶Šå¤§çš„æœåŠ¡å™¨ï¼Œåœ¨è½®ç›˜ä¸Šå æ®çš„åŒºåŸŸè¶Šå¤§ï¼Œè¢«é€‰ä¸­çš„æ¦‚ç‡ä¹Ÿå°±è¶Šé«˜ã€‚</p>
<p><strong>ä¼˜åŒ–æ€è·¯</strong>ï¼šæ ‡å‡†çš„è½®ç›˜èµŒé€‰æ‹©ç®—æ³•éœ€è¦O(n)çš„æ—¶é—´å¤æ‚åº¦ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¼˜åŒ–ï¼š</p>
<ul>
<li><strong>äºŒåˆ†æœç´¢(Binary Search)</strong>ï¼šå°†ç´¯ç§¯æƒé‡æ•°ç»„æ’åºåï¼Œä½¿ç”¨äºŒåˆ†æœç´¢æ‰¾åˆ°éšæœºå€¼å¯¹åº”çš„æœåŠ¡å™¨ï¼Œå°†å¤æ‚åº¦é™è‡³O(log n)</li>
<li><strong>åˆ«åæ–¹æ³•(Alias Method)</strong>ï¼šä»¥O(n)çš„é¢„å¤„ç†æ—¶é—´å’ŒO(1)çš„æŸ¥è¯¢æ—¶é—´å®ç°åŠ æƒéšæœºé€‰æ‹©</li>
<li><strong>è“„æ°´æ± æŠ½æ ·(Reservoir Sampling)</strong>ï¼šå½“æœåŠ¡å™¨åˆ—è¡¨åŠ¨æ€å˜åŒ–æ—¶ç‰¹åˆ«æœ‰ç”¨</li>
</ul>
<h3 id="æ ¸å¿ƒå®ç°">æ ¸å¿ƒå®ç°<a class="headerlink" href="#æ ¸å¿ƒå®ç°" title="Permanent link">&para;</a></h3>
<p>éšæœºç®—æ³•çš„å®ç°ç›¸å¯¹ç®€å•ï¼š</p>
<div class="language-go highlight"><span class="filename">Go</span><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><a href="#__codelineno-3-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="c1">// GetServer éšæœºé€‰æ‹©ä¸€ä¸ªæœåŠ¡å™¨</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><a href="#__codelineno-3-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">RandomLoadBalancer</span><span class="p">)</span><span class="w"> </span><span class="nx">GetServer</span><span class="p">(</span><span class="nx">key</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><a href="#__codelineno-3-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">RLock</span><span class="p">()</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><a href="#__codelineno-3-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">RUnlock</span><span class="p">()</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><a href="#__codelineno-3-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><a href="#__codelineno-3-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span><span class="c1">// è¿‡æ»¤å‡ºå¯ç”¨çš„æœåŠ¡å™¨</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><a href="#__codelineno-3-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span><span class="nx">availableServers</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="o">*</span><span class="nx">Server</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><a href="#__codelineno-3-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Servers</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><a href="#__codelineno-3-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">Weight</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a><a href="#__codelineno-3-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">            </span><span class="nx">availableServers</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">availableServers</span><span class="p">,</span><span class="w"> </span><span class="nx">server</span><span class="p">)</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a><a href="#__codelineno-3-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a><a href="#__codelineno-3-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a><a href="#__codelineno-3-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a><a href="#__codelineno-3-14"><span class="linenos" data-linenos="14 "></span></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">availableServers</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a><a href="#__codelineno-3-15"><span class="linenos" data-linenos="15 "></span></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-3-16" name="__codelineno-3-16"></a><a href="#__codelineno-3-16"><span class="linenos" data-linenos="16 "></span></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-17" name="__codelineno-3-17"></a><a href="#__codelineno-3-17"><span class="linenos" data-linenos="17 "></span></a>
<a id="__codelineno-3-18" name="__codelineno-3-18"></a><a href="#__codelineno-3-18"><span class="linenos" data-linenos="18 "></span></a><span class="w">    </span><span class="c1">// è®¡ç®—æ€»æƒé‡</span>
<a id="__codelineno-3-19" name="__codelineno-3-19"></a><a href="#__codelineno-3-19"><span class="linenos" data-linenos="19 "></span></a><span class="w">    </span><span class="nx">totalWeight</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-3-20" name="__codelineno-3-20"></a><a href="#__codelineno-3-20"><span class="linenos" data-linenos="20 "></span></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">availableServers</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-21" name="__codelineno-3-21"></a><a href="#__codelineno-3-21"><span class="linenos" data-linenos="21 "></span></a><span class="w">        </span><span class="nx">totalWeight</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">Weight</span>
<a id="__codelineno-3-22" name="__codelineno-3-22"></a><a href="#__codelineno-3-22"><span class="linenos" data-linenos="22 "></span></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-23" name="__codelineno-3-23"></a><a href="#__codelineno-3-23"><span class="linenos" data-linenos="23 "></span></a>
<a id="__codelineno-3-24" name="__codelineno-3-24"></a><a href="#__codelineno-3-24"><span class="linenos" data-linenos="24 "></span></a><span class="w">    </span><span class="c1">// éšæœºé€‰æ‹©ä¸€ä¸ªæœåŠ¡å™¨ï¼ˆè€ƒè™‘æƒé‡ï¼‰</span>
<a id="__codelineno-3-25" name="__codelineno-3-25"></a><a href="#__codelineno-3-25"><span class="linenos" data-linenos="25 "></span></a><span class="w">    </span><span class="nx">randomWeight</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">rng</span><span class="p">.</span><span class="nx">Intn</span><span class="p">(</span><span class="nx">totalWeight</span><span class="p">)</span>
<a id="__codelineno-3-26" name="__codelineno-3-26"></a><a href="#__codelineno-3-26"><span class="linenos" data-linenos="26 "></span></a><span class="w">    </span><span class="nx">currentWeight</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-3-27" name="__codelineno-3-27"></a><a href="#__codelineno-3-27"><span class="linenos" data-linenos="27 "></span></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">availableServers</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-28" name="__codelineno-3-28"></a><a href="#__codelineno-3-28"><span class="linenos" data-linenos="28 "></span></a><span class="w">        </span><span class="nx">currentWeight</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">Weight</span>
<a id="__codelineno-3-29" name="__codelineno-3-29"></a><a href="#__codelineno-3-29"><span class="linenos" data-linenos="29 "></span></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">randomWeight</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">currentWeight</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-30" name="__codelineno-3-30"></a><a href="#__codelineno-3-30"><span class="linenos" data-linenos="30 "></span></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">server</span>
<a id="__codelineno-3-31" name="__codelineno-3-31"></a><a href="#__codelineno-3-31"><span class="linenos" data-linenos="31 "></span></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-3-32" name="__codelineno-3-32"></a><a href="#__codelineno-3-32"><span class="linenos" data-linenos="32 "></span></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-33" name="__codelineno-3-33"></a><a href="#__codelineno-3-33"><span class="linenos" data-linenos="33 "></span></a>
<a id="__codelineno-3-34" name="__codelineno-3-34"></a><a href="#__codelineno-3-34"><span class="linenos" data-linenos="34 "></span></a><span class="w">    </span><span class="c1">// å¦‚æœå› ä¸ºæµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜æ²¡æœ‰é€‰ä¸­ä»»ä½•æœåŠ¡å™¨ï¼Œè¿”å›æœ€åä¸€ä¸ª</span>
<a id="__codelineno-3-35" name="__codelineno-3-35"></a><a href="#__codelineno-3-35"><span class="linenos" data-linenos="35 "></span></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">availableServers</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">availableServers</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-3-36" name="__codelineno-3-36"></a><a href="#__codelineno-3-36"><span class="linenos" data-linenos="36 "></span></a><span class="p">}</span>
</code></pre></div>
<h3 id="ä¼˜ç¼ºç‚¹åˆ†æ">ä¼˜ç¼ºç‚¹åˆ†æ<a class="headerlink" href="#ä¼˜ç¼ºç‚¹åˆ†æ" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>âœ… å®ç°æœ€ç®€å•ï¼Œè®¡ç®—å¼€é”€å°ï¼ˆæ ‡å‡†å®ç°ä¸ºO(n)ï¼Œå¯ä¼˜åŒ–è‡³O(log n)æˆ–O(1)ï¼‰</td>
<td>âŒ ä¸è€ƒè™‘æœåŠ¡å™¨å®æ—¶è´Ÿè½½æƒ…å†µ</td>
</tr>
<tr>
<td>âœ… é€‚åˆæœåŠ¡å™¨æ€§èƒ½ç›¸è¿‘çš„åœºæ™¯</td>
<td>âŒ å¯èƒ½å¯¼è‡´è¯·æ±‚åˆ†å¸ƒä¸å‡</td>
</tr>
<tr>
<td>âœ… æ— éœ€ç»´æŠ¤å…¨å±€çŠ¶æ€</td>
<td>âŒ å¯¹äºé•¿è¿æ¥åœºæ™¯å¯èƒ½é€ æˆæŸäº›æœåŠ¡å™¨è´Ÿè½½è¿‡é«˜</td>
</tr>
<tr>
<td>âœ… ä»£ç é‡å°‘ï¼Œæ˜“äºç»´æŠ¤</td>
<td>âŒ æ— æ³•ä¿è¯ä¼šè¯ä¸€è‡´æ€§</td>
</tr>
</tbody>
</table>
<h2 id="2-è½®è¯¢ç®—æ³•-">2. è½®è¯¢ç®—æ³• ğŸ”„<a class="headerlink" href="#2-è½®è¯¢ç®—æ³•-" title="Permanent link">&para;</a></h2>
<h3 id="ç®—æ³•åŸç†_1">ç®—æ³•åŸç†<a class="headerlink" href="#ç®—æ³•åŸç†_1" title="Permanent link">&para;</a></h3>
<p>è½®è¯¢ï¼ˆRound Robinï¼‰æŒ‰ç…§é¢„å®šä¹‰çš„é¡ºåºä¾æ¬¡é€‰æ‹©æœåŠ¡å™¨ï¼Œå®ç°è¯·æ±‚çš„å¹³å‡åˆ†é…ã€‚</p>
<ul>
<li><strong>æ™®é€šè½®è¯¢</strong>ï¼šä¾æ¬¡é€‰æ‹©æœåŠ¡å™¨ï¼Œå®ç°è¯·æ±‚å‡åŒ€åˆ†é…</li>
<li><strong>åŠ æƒè½®è¯¢</strong>ï¼šæƒé‡å¤§çš„æœåŠ¡å™¨å¤„ç†æ›´å¤šè¯·æ±‚ï¼Œé‡‡ç”¨å¹³æ»‘åŠ æƒè½®è¯¢ç®—æ³•ç¡®ä¿å‡åŒ€æ€§</li>
</ul>
<p><strong>æ™®é€šè½®è¯¢æµç¨‹å›¾</strong>ï¼š</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><a href="#__codelineno-4-1"><span class="linenos" data-linenos=" 1 "></span></a>å¼€å§‹
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><a href="#__codelineno-4-2"><span class="linenos" data-linenos=" 2 "></span></a>  â†“
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><a href="#__codelineno-4-3"><span class="linenos" data-linenos=" 3 "></span></a>åˆå§‹åŒ–è®¡æ•°å™¨ index = 0
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><a href="#__codelineno-4-4"><span class="linenos" data-linenos=" 4 "></span></a>  â†“
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><a href="#__codelineno-4-5"><span class="linenos" data-linenos=" 5 "></span></a>æ”¶åˆ°æ–°è¯·æ±‚
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><a href="#__codelineno-4-6"><span class="linenos" data-linenos=" 6 "></span></a>  â†“
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><a href="#__codelineno-4-7"><span class="linenos" data-linenos=" 7 "></span></a>index = (index + 1) % æœåŠ¡å™¨æ€»æ•°
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><a href="#__codelineno-4-8"><span class="linenos" data-linenos=" 8 "></span></a>  â†“
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><a href="#__codelineno-4-9"><span class="linenos" data-linenos=" 9 "></span></a>è¿”å› servers[index] æœåŠ¡å™¨
<a id="__codelineno-4-10" name="__codelineno-4-10"></a><a href="#__codelineno-4-10"><span class="linenos" data-linenos="10 "></span></a>  â†“
<a id="__codelineno-4-11" name="__codelineno-4-11"></a><a href="#__codelineno-4-11"><span class="linenos" data-linenos="11 "></span></a>ç»“æŸ
</code></pre></div>
<p><strong>å¹³æ»‘åŠ æƒè½®è¯¢æµç¨‹å›¾</strong>ï¼š</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><a href="#__codelineno-5-1"><span class="linenos" data-linenos=" 1 "></span></a>å¼€å§‹
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><a href="#__codelineno-5-2"><span class="linenos" data-linenos=" 2 "></span></a>  â†“
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><a href="#__codelineno-5-3"><span class="linenos" data-linenos=" 3 "></span></a>åˆå§‹åŒ–æ‰€æœ‰æœåŠ¡å™¨çš„CurrentWeight=0
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><a href="#__codelineno-5-4"><span class="linenos" data-linenos=" 4 "></span></a>  â†“
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><a href="#__codelineno-5-5"><span class="linenos" data-linenos=" 5 "></span></a>åˆå§‹åŒ–æ‰€æœ‰æœåŠ¡å™¨çš„EffectiveWeight=Weight
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><a href="#__codelineno-5-6"><span class="linenos" data-linenos=" 6 "></span></a>  â†“
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><a href="#__codelineno-5-7"><span class="linenos" data-linenos=" 7 "></span></a>å¾ªç¯å¤„ç†è¯·æ±‚
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><a href="#__codelineno-5-8"><span class="linenos" data-linenos=" 8 "></span></a>  â†“
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><a href="#__codelineno-5-9"><span class="linenos" data-linenos=" 9 "></span></a>  â”œâ”€â†’ ä¸ºæ¯ä¸ªæœåŠ¡å™¨çš„CurrentWeightå¢åŠ å…¶EffectiveWeight
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><a href="#__codelineno-5-10"><span class="linenos" data-linenos="10 "></span></a>  â”‚   â†“
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><a href="#__codelineno-5-11"><span class="linenos" data-linenos="11 "></span></a>  â”‚   é€‰æ‹©CurrentWeightæœ€å¤§çš„æœåŠ¡å™¨
<a id="__codelineno-5-12" name="__codelineno-5-12"></a><a href="#__codelineno-5-12"><span class="linenos" data-linenos="12 "></span></a>  â”‚   â†“
<a id="__codelineno-5-13" name="__codelineno-5-13"></a><a href="#__codelineno-5-13"><span class="linenos" data-linenos="13 "></span></a>  â”‚   è¢«é€‰ä¸­æœåŠ¡å™¨çš„CurrentWeightå‡å»æ‰€æœ‰æœåŠ¡å™¨çš„EffectiveWeightä¹‹å’Œ
<a id="__codelineno-5-14" name="__codelineno-5-14"></a><a href="#__codelineno-5-14"><span class="linenos" data-linenos="14 "></span></a>  â”‚   â†“
<a id="__codelineno-5-15" name="__codelineno-5-15"></a><a href="#__codelineno-5-15"><span class="linenos" data-linenos="15 "></span></a>  â”‚   è¿”å›è¢«é€‰ä¸­çš„æœåŠ¡å™¨
<a id="__codelineno-5-16" name="__codelineno-5-16"></a><a href="#__codelineno-5-16"><span class="linenos" data-linenos="16 "></span></a>  â””â”€â†â”€
<a id="__codelineno-5-17" name="__codelineno-5-17"></a><a href="#__codelineno-5-17"><span class="linenos" data-linenos="17 "></span></a>  â†“
<a id="__codelineno-5-18" name="__codelineno-5-18"></a><a href="#__codelineno-5-18"><span class="linenos" data-linenos="18 "></span></a>ç»“æŸ
</code></pre></div>
<h3 id="å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”_1">å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”<a class="headerlink" href="#å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”_1" title="Permanent link">&para;</a></h3>
<p>è½®è¯¢ç®—æ³•å¯¹åº”å‡ ä¸ªç»å…¸çš„è®¡ç®—æœºç§‘å­¦é—®é¢˜ï¼š</p>
<ol>
<li><strong>CPUè°ƒåº¦ä¸­çš„æ—¶é—´ç‰‡è½®è½¬(Round-Robin Scheduling)</strong>ï¼šæ“ä½œç³»ç»Ÿä¸­æœ€åŸºæœ¬çš„CPUè°ƒåº¦ç®—æ³•ï¼Œç»™æ¯ä¸ªè¿›ç¨‹åˆ†é…å›ºå®šçš„æ—¶é—´ç‰‡ï¼Œè½®æµæ‰§è¡Œ</li>
<li><strong>ä»¤ç‰Œæ¡¶(Token Bucket)ä¸æ¼æ¡¶(Leaky Bucket)ç®—æ³•</strong>ï¼šç½‘ç»œæµé‡æ•´å½¢å’Œé™æµç®—æ³•ä¸­çš„åŸºæœ¬æ¦‚å¿µ</li>
<li><strong>å…¬å¹³é˜Ÿåˆ—(Fair Queuing)</strong>ï¼šç½‘ç»œæ•°æ®åŒ…è°ƒåº¦ä¸­ä¿è¯å„æµé‡è·å¾—å…¬å¹³æœåŠ¡çš„ç®—æ³•</li>
</ol>
<p><strong>ç±»æ¯”æ€è·¯</strong>ï¼šå¹³æ»‘åŠ æƒè½®è¯¢ç®—æ³•å¯ä»¥ç±»æ¯”ä¸ºä¸€ä¸ª"å€ºåŠ¡ç³»ç»Ÿ"ã€‚æ¯ä¸ªæœåŠ¡å™¨æ ¹æ®å…¶æƒé‡ä»ç³»ç»Ÿ"å€Ÿå–"è¯·æ±‚ï¼Œè¢«é€‰ä¸­åéœ€è¦"å¿è¿˜"æ¬ æ¬¾ã€‚å…·ä½“æ¥è¯´ï¼š</p>
<ul>
<li>æ¯è½®é€‰æ‹©å‰ï¼Œæ¯ä¸ªæœåŠ¡å™¨å¢åŠ ç­‰äºå…¶æƒé‡çš„"ä¿¡ç”¨"(CurrentWeight += EffectiveWeight)</li>
<li>é€‰æ‹©"ä¿¡ç”¨"æœ€é«˜çš„æœåŠ¡å™¨å¤„ç†è¯·æ±‚</li>
<li>è¢«é€‰ä¸­çš„æœåŠ¡å™¨éœ€è¦"å¿è¿˜"æ€»æƒé‡çš„"å€ºåŠ¡"(CurrentWeight -= TotalWeight)</li>
</ul>
<p>è¿™ç§"å€ºåŠ¡ç³»ç»Ÿ"ç¡®ä¿äº†é•¿æœŸè¿è¡Œä¸­ï¼ŒæœåŠ¡å™¨è¢«é€‰ä¸­çš„æ¬¡æ•°ä¸å…¶æƒé‡æˆæ­£æ¯”ï¼ŒåŒæ—¶åˆ†é…è¿‡ç¨‹æ›´åŠ å¹³æ»‘ã€‚</p>
<p><strong>æ‰©å±•åº”ç”¨</strong>ï¼šå¹³æ»‘åŠ æƒè½®è¯¢ç®—æ³•æœ€åˆç”±Nginxå¼€å‘è€…Igor Sysoevæå‡ºï¼Œç”¨äºHTTPè¯·æ±‚çš„è´Ÿè½½å‡è¡¡ã€‚è¿™ä¸ªç®—æ³•å·²è¢«è¯æ˜åœ¨ä»¥ä¸‹æ–¹é¢éå¸¸æœ‰æ•ˆï¼š</p>
<ul>
<li>åœ¨é•¿æœŸè¿è¡Œä¸­ä¿æŒç²¾ç¡®çš„æƒé‡æ¯”ä¾‹</li>
<li>é¿å…äº†æ™®é€šåŠ æƒè½®è¯¢ä¸­å¯èƒ½å‡ºç°çš„è¯·æ±‚èšé›†é—®é¢˜</li>
<li>æœåŠ¡è¯·æ±‚çš„åˆ†å¸ƒæ›´åŠ å‡åŒ€ï¼Œæ²¡æœ‰æ˜æ˜¾çš„å‘¨æœŸæ€§æ¨¡å¼</li>
</ul>
<p>å¹³æ»‘åŠ æƒè½®è¯¢çš„æ€æƒ³ä¹Ÿå¯ä»¥æ‰©å±•åº”ç”¨åˆ°å…¶ä»–èµ„æºåˆ†é…é—®é¢˜ï¼Œå¦‚æ•°æ®åŒ…è°ƒåº¦ã€CPUæ—¶é—´åˆ†é…ç­‰åœºæ™¯ã€‚</p>
<h3 id="æ ¸å¿ƒå®ç°_1">æ ¸å¿ƒå®ç°<a class="headerlink" href="#æ ¸å¿ƒå®ç°_1" title="Permanent link">&para;</a></h3>
<div class="language-go highlight"><span class="filename">Go</span><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><a href="#__codelineno-6-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="c1">// GetServer è·å–ä¸‹ä¸€ä¸ªæœåŠ¡å™¨</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><a href="#__codelineno-6-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">lb</span><span class="w"> </span><span class="o">*</span><span class="nx">RoundRobinLoadBalancer</span><span class="p">)</span><span class="w"> </span><span class="nx">GetServer</span><span class="p">(</span><span class="nx">key</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><a href="#__codelineno-6-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w">    </span><span class="nx">lb</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><a href="#__codelineno-6-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">lb</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><a href="#__codelineno-6-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><a href="#__codelineno-6-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">lb</span><span class="p">.</span><span class="nx">Servers</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><a href="#__codelineno-6-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a><a href="#__codelineno-6-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><a href="#__codelineno-6-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a><a href="#__codelineno-6-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">lb</span><span class="p">.</span><span class="nx">weighted</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a><a href="#__codelineno-6-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">        </span><span class="c1">// éåŠ æƒè½®è¯¢</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a><a href="#__codelineno-6-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">        </span><span class="nx">index</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">atomic</span><span class="p">.</span><span class="nx">AddInt64</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lb</span><span class="p">.</span><span class="nx">currentIndex</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nb">int64</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">lb</span><span class="p">.</span><span class="nx">Servers</span><span class="p">))</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a><a href="#__codelineno-6-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">lb</span><span class="p">.</span><span class="nx">Servers</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a><a href="#__codelineno-6-14"><span class="linenos" data-linenos="14 "></span></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a><a href="#__codelineno-6-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a><a href="#__codelineno-6-16"><span class="linenos" data-linenos="16 "></span></a><span class="w">    </span><span class="c1">// å®ç°å¹³æ»‘åŠ æƒè½®è¯¢ï¼ˆSmooth Weighted Round-Robinï¼‰</span>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a><a href="#__codelineno-6-17"><span class="linenos" data-linenos="17 "></span></a><span class="w">    </span><span class="nx">totalWeight</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a><a href="#__codelineno-6-18"><span class="linenos" data-linenos="18 "></span></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">bestServer</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a><a href="#__codelineno-6-19"><span class="linenos" data-linenos="19 "></span></a>
<a id="__codelineno-6-20" name="__codelineno-6-20"></a><a href="#__codelineno-6-20"><span class="linenos" data-linenos="20 "></span></a><span class="w">    </span><span class="c1">// è®¡ç®—æ€»æœ‰æ•ˆæƒé‡ï¼Œå¹¶ä¸ºæ¯ä¸ªæœåŠ¡å™¨å¢åŠ å½“å‰æƒé‡</span>
<a id="__codelineno-6-21" name="__codelineno-6-21"></a><a href="#__codelineno-6-21"><span class="linenos" data-linenos="21 "></span></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">lb</span><span class="p">.</span><span class="nx">Servers</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-22" name="__codelineno-6-22"></a><a href="#__codelineno-6-22"><span class="linenos" data-linenos="22 "></span></a><span class="w">        </span><span class="c1">// ç¡®ä¿æœ‰æ•ˆæƒé‡è¢«åˆå§‹åŒ–</span>
<a id="__codelineno-6-23" name="__codelineno-6-23"></a><a href="#__codelineno-6-23"><span class="linenos" data-linenos="23 "></span></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">EffectiveWeight</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-24" name="__codelineno-6-24"></a><a href="#__codelineno-6-24"><span class="linenos" data-linenos="24 "></span></a><span class="w">            </span><span class="nx">server</span><span class="p">.</span><span class="nx">EffectiveWeight</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">Weight</span>
<a id="__codelineno-6-25" name="__codelineno-6-25"></a><a href="#__codelineno-6-25"><span class="linenos" data-linenos="25 "></span></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-26" name="__codelineno-6-26"></a><a href="#__codelineno-6-26"><span class="linenos" data-linenos="26 "></span></a><span class="w">        </span><span class="c1">// å½“å‰æƒé‡å¢åŠ æœ‰æ•ˆæƒé‡</span>
<a id="__codelineno-6-27" name="__codelineno-6-27"></a><a href="#__codelineno-6-27"><span class="linenos" data-linenos="27 "></span></a><span class="w">        </span><span class="nx">server</span><span class="p">.</span><span class="nx">CurrentWeight</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">EffectiveWeight</span>
<a id="__codelineno-6-28" name="__codelineno-6-28"></a><a href="#__codelineno-6-28"><span class="linenos" data-linenos="28 "></span></a><span class="w">        </span><span class="nx">totalWeight</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">EffectiveWeight</span>
<a id="__codelineno-6-29" name="__codelineno-6-29"></a><a href="#__codelineno-6-29"><span class="linenos" data-linenos="29 "></span></a>
<a id="__codelineno-6-30" name="__codelineno-6-30"></a><a href="#__codelineno-6-30"><span class="linenos" data-linenos="30 "></span></a><span class="w">        </span><span class="c1">// é€‰æ‹©å½“å‰æƒé‡æœ€å¤§çš„æœåŠ¡å™¨</span>
<a id="__codelineno-6-31" name="__codelineno-6-31"></a><a href="#__codelineno-6-31"><span class="linenos" data-linenos="31 "></span></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">bestServer</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">CurrentWeight</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="nx">bestServer</span><span class="p">.</span><span class="nx">CurrentWeight</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-32" name="__codelineno-6-32"></a><a href="#__codelineno-6-32"><span class="linenos" data-linenos="32 "></span></a><span class="w">            </span><span class="nx">bestServer</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">server</span>
<a id="__codelineno-6-33" name="__codelineno-6-33"></a><a href="#__codelineno-6-33"><span class="linenos" data-linenos="33 "></span></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-34" name="__codelineno-6-34"></a><a href="#__codelineno-6-34"><span class="linenos" data-linenos="34 "></span></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-35" name="__codelineno-6-35"></a><a href="#__codelineno-6-35"><span class="linenos" data-linenos="35 "></span></a>
<a id="__codelineno-6-36" name="__codelineno-6-36"></a><a href="#__codelineno-6-36"><span class="linenos" data-linenos="36 "></span></a><span class="w">    </span><span class="c1">// å¦‚æœæ‰¾åˆ°äº†æœ€ä½³æœåŠ¡å™¨ï¼Œå‡å°‘å…¶å½“å‰æƒé‡</span>
<a id="__codelineno-6-37" name="__codelineno-6-37"></a><a href="#__codelineno-6-37"><span class="linenos" data-linenos="37 "></span></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">bestServer</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-38" name="__codelineno-6-38"></a><a href="#__codelineno-6-38"><span class="linenos" data-linenos="38 "></span></a><span class="w">        </span><span class="nx">bestServer</span><span class="p">.</span><span class="nx">CurrentWeight</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">totalWeight</span>
<a id="__codelineno-6-39" name="__codelineno-6-39"></a><a href="#__codelineno-6-39"><span class="linenos" data-linenos="39 "></span></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-40" name="__codelineno-6-40"></a><a href="#__codelineno-6-40"><span class="linenos" data-linenos="40 "></span></a>
<a id="__codelineno-6-41" name="__codelineno-6-41"></a><a href="#__codelineno-6-41"><span class="linenos" data-linenos="41 "></span></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">bestServer</span>
<a id="__codelineno-6-42" name="__codelineno-6-42"></a><a href="#__codelineno-6-42"><span class="linenos" data-linenos="42 "></span></a><span class="p">}</span>
</code></pre></div>
<h3 id="å¹³æ»‘åŠ æƒè½®è¯¢è¯¦è§£">å¹³æ»‘åŠ æƒè½®è¯¢è¯¦è§£<a class="headerlink" href="#å¹³æ»‘åŠ æƒè½®è¯¢è¯¦è§£" title="Permanent link">&para;</a></h3>
<p>å¹³æ»‘åŠ æƒè½®è¯¢ï¼ˆSmooth Weighted Round-Robinï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„åŠ æƒè½®è¯¢ç®—æ³•ï¼Œå¯ä»¥ä½¿å¾—æƒé‡åˆ†é…æ›´åŠ å‡åŒ€å¹³æ»‘ã€‚ç®—æ³•è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p>
<ol>
<li>åˆå§‹åŒ–æ¯ä¸ªæœåŠ¡å™¨çš„å½“å‰æƒé‡ï¼ˆCurrentWeightï¼‰ä¸º0</li>
<li>æ¯æ¬¡é€‰æ‹©æœåŠ¡å™¨æ—¶ï¼Œå°†æ¯ä¸ªæœåŠ¡å™¨çš„å½“å‰æƒé‡å¢åŠ å…¶æœ‰æ•ˆæƒé‡ï¼ˆEffectiveWeightï¼‰</li>
<li>é€‰æ‹©å½“å‰æƒé‡æœ€å¤§çš„æœåŠ¡å™¨</li>
<li>è¢«é€‰ä¸­çš„æœåŠ¡å™¨çš„å½“å‰æƒé‡å‡å»æ‰€æœ‰æœåŠ¡å™¨çš„æœ‰æ•ˆæƒé‡ä¹‹å’Œ</li>
</ol>
<p>ä¸‹é¢ç”¨ä¸€ä¸ªå…·ä½“ä¾‹å­æ¥è¯´æ˜å¹³æ»‘åŠ æƒè½®è¯¢çš„å·¥ä½œè¿‡ç¨‹ï¼š</p>
<p>å‡è®¾æœ‰3å°æœåŠ¡å™¨ï¼Œæƒé‡åˆ†åˆ«ä¸ºï¼šA=5, B=1, C=1</p>
<table>
<thead>
<tr>
<th>è½®æ¬¡</th>
<th>æ“ä½œå‰æƒé‡(A,B,C)</th>
<th>é€‰ä¸­æœåŠ¡å™¨</th>
<th>æ“ä½œåæƒé‡(A,B,C)</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>(5,1,1)</td>
<td>A</td>
<td>(-2,1,1)</td>
</tr>
<tr>
<td>2</td>
<td>(3,2,2)</td>
<td>A</td>
<td>(-4,2,2)</td>
</tr>
<tr>
<td>3</td>
<td>(1,3,3)</td>
<td>B/C</td>
<td>(1,-4,3)æˆ–(1,3,-4)</td>
</tr>
<tr>
<td>4</td>
<td>(6,-3,4)æˆ–(6,4,-3)</td>
<td>A</td>
<td>(-1,-3,4)æˆ–(-1,4,-3)</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
</tbody>
</table>
<p>è¿™ç§æ–¹å¼å¯ä»¥é¿å…æ™®é€šåŠ æƒè½®è¯¢ä¸­å¯èƒ½å‡ºç°çš„ä¸å¹³æ»‘åˆ†é…é—®é¢˜ã€‚</p>
<h3 id="ä¼˜ç¼ºç‚¹åˆ†æ_1">ä¼˜ç¼ºç‚¹åˆ†æ<a class="headerlink" href="#ä¼˜ç¼ºç‚¹åˆ†æ_1" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>âœ… å®ç°ç®€å•ï¼Œè®¡ç®—å¼€é”€å°</td>
<td>âŒ ä¸è€ƒè™‘æœåŠ¡å™¨çš„å®æ—¶è´Ÿè½½æƒ…å†µ</td>
</tr>
<tr>
<td>âœ… æœåŠ¡å™¨è¯·æ±‚åˆ†é…éå¸¸å‡åŒ€</td>
<td>âŒ è¯·æ±‚å¤„ç†æ—¶é—´ä¸ä¸€è‡´æ—¶ä¼šå¯¼è‡´è´Ÿè½½ä¸å‡</td>
</tr>
<tr>
<td>âœ… æ”¯æŒæœåŠ¡å™¨åŠ¨æ€æƒé‡è°ƒæ•´</td>
<td>âŒ éœ€è¦ç»´æŠ¤å…¨å±€è®¡æ•°å™¨ï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­å®ç°å¤æ‚</td>
</tr>
<tr>
<td>âœ… æ— éœ€é¢å¤–çš„éšæœºæ•°ç”Ÿæˆå™¨</td>
<td>âŒ åœ¨æœåŠ¡å™¨æ•°é‡é¢‘ç¹å˜åŒ–æ—¶éœ€è¦é‡æ–°è®¡ç®—</td>
</tr>
</tbody>
</table>
<h2 id="3-æœ€å°è¿æ¥ç®—æ³•-">3. æœ€å°è¿æ¥ç®—æ³• ğŸ”Œ<a class="headerlink" href="#3-æœ€å°è¿æ¥ç®—æ³•-" title="Permanent link">&para;</a></h2>
<h3 id="ç®—æ³•åŸç†_2">ç®—æ³•åŸç†<a class="headerlink" href="#ç®—æ³•åŸç†_2" title="Permanent link">&para;</a></h3>
<p>æœ€å°è¿æ¥ï¼ˆLeast Connectionsï¼‰æ ¹æ®æœåŠ¡å™¨å½“å‰çš„è¿æ¥æ•°åŠ¨æ€åˆ†é…è¯·æ±‚ï¼Œä¼˜å…ˆå°†è¯·æ±‚å‘é€åˆ°è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨ã€‚</p>
<ul>
<li><strong>æ™®é€šæœ€å°è¿æ¥</strong>ï¼šé€‰æ‹©å½“å‰è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨</li>
<li><strong>åŠ æƒæœ€å°è¿æ¥</strong>ï¼šç»¼åˆè€ƒè™‘æœåŠ¡å™¨æƒé‡å’Œå½“å‰è¿æ¥æ•°çš„æ¯”å€¼</li>
</ul>
<p><strong>æœ€å°è¿æ¥ç®—æ³•æµç¨‹å›¾</strong>ï¼š</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><a href="#__codelineno-7-1"><span class="linenos" data-linenos=" 1 "></span></a>å¼€å§‹
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><a href="#__codelineno-7-2"><span class="linenos" data-linenos=" 2 "></span></a>  â†“
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><a href="#__codelineno-7-3"><span class="linenos" data-linenos=" 3 "></span></a>è¿‡æ»¤å‡ºæƒé‡&gt;0çš„å¯ç”¨æœåŠ¡å™¨
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><a href="#__codelineno-7-4"><span class="linenos" data-linenos=" 4 "></span></a>  â†“
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><a href="#__codelineno-7-5"><span class="linenos" data-linenos=" 5 "></span></a>å¯¹äºæ¯ä¸ªæœåŠ¡å™¨è®¡ç®—è¿æ¥è¯„åˆ†
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><a href="#__codelineno-7-6"><span class="linenos" data-linenos=" 6 "></span></a>  â”œâ”€â†’ æ™®é€šæ¨¡å¼ï¼šè¯„åˆ† = å½“å‰è¿æ¥æ•°
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><a href="#__codelineno-7-7"><span class="linenos" data-linenos=" 7 "></span></a>  â””â”€â†’ åŠ æƒæ¨¡å¼ï¼šè¯„åˆ† = å½“å‰è¿æ¥æ•°/æƒé‡
<a id="__codelineno-7-8" name="__codelineno-7-8"></a><a href="#__codelineno-7-8"><span class="linenos" data-linenos=" 8 "></span></a>  â†“
<a id="__codelineno-7-9" name="__codelineno-7-9"></a><a href="#__codelineno-7-9"><span class="linenos" data-linenos=" 9 "></span></a>é€‰æ‹©è¯„åˆ†æœ€ä½çš„æœåŠ¡å™¨
<a id="__codelineno-7-10" name="__codelineno-7-10"></a><a href="#__codelineno-7-10"><span class="linenos" data-linenos="10 "></span></a>  â†“
<a id="__codelineno-7-11" name="__codelineno-7-11"></a><a href="#__codelineno-7-11"><span class="linenos" data-linenos="11 "></span></a>å¢åŠ è¢«é€‰ä¸­æœåŠ¡å™¨çš„è¿æ¥è®¡æ•°
<a id="__codelineno-7-12" name="__codelineno-7-12"></a><a href="#__codelineno-7-12"><span class="linenos" data-linenos="12 "></span></a>  â†“
<a id="__codelineno-7-13" name="__codelineno-7-13"></a><a href="#__codelineno-7-13"><span class="linenos" data-linenos="13 "></span></a>è¿”å›è¢«é€‰ä¸­çš„æœåŠ¡å™¨
<a id="__codelineno-7-14" name="__codelineno-7-14"></a><a href="#__codelineno-7-14"><span class="linenos" data-linenos="14 "></span></a>  â†“
<a id="__codelineno-7-15" name="__codelineno-7-15"></a><a href="#__codelineno-7-15"><span class="linenos" data-linenos="15 "></span></a>è¯·æ±‚å¤„ç†å®Œæˆå
<a id="__codelineno-7-16" name="__codelineno-7-16"></a><a href="#__codelineno-7-16"><span class="linenos" data-linenos="16 "></span></a>  â†“
<a id="__codelineno-7-17" name="__codelineno-7-17"></a><a href="#__codelineno-7-17"><span class="linenos" data-linenos="17 "></span></a>å‡å°‘å¯¹åº”æœåŠ¡å™¨çš„è¿æ¥è®¡æ•°
<a id="__codelineno-7-18" name="__codelineno-7-18"></a><a href="#__codelineno-7-18"><span class="linenos" data-linenos="18 "></span></a>  â†“
<a id="__codelineno-7-19" name="__codelineno-7-19"></a><a href="#__codelineno-7-19"><span class="linenos" data-linenos="19 "></span></a>ç»“æŸ
</code></pre></div>
<h3 id="å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”_2">å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”<a class="headerlink" href="#å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”_2" title="Permanent link">&para;</a></h3>
<p>æœ€å°è¿æ¥ç®—æ³•å¯¹åº”ç€å¤šä¸ªç»å…¸çš„èµ„æºåˆ†é…ä¸ä¼˜åŒ–é—®é¢˜ï¼š</p>
<ol>
<li><strong>å¤šé˜Ÿåˆ—ç³»ç»Ÿä¸­çš„æœ€çŸ­é˜Ÿåˆ—ä¼˜å…ˆ(Join Shortest Queue)</strong>ï¼šåœ¨æ’é˜Ÿè®ºä¸­ï¼Œå½“é¡¾å®¢åˆ°è¾¾æ—¶é€‰æ‹©æœ€çŸ­çš„é˜Ÿåˆ—åŠ å…¥ï¼Œä»¥æœ€å°åŒ–ç­‰å¾…æ—¶é—´</li>
<li><strong>æœ€å°‘å‰©ä½™å¤„ç†æ—¶é—´è°ƒåº¦(Shortest Remaining Processing Time)</strong>ï¼šåœ¨ä½œä¸šè°ƒåº¦ä¸­ï¼Œä¼˜å…ˆå¤„ç†å‰©ä½™å·¥ä½œé‡æœ€å°çš„ä»»åŠ¡</li>
<li><strong>è´Ÿè½½æ„ŸçŸ¥çš„èµ„æºåˆ†é…(Load-Aware Resource Allocation)</strong>ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ ¹æ®å½“å‰è´Ÿè½½çŠ¶æ€åŠ¨æ€è°ƒæ•´èµ„æºåˆ†é…ç­–ç•¥</li>
</ol>
<p><strong>ç±»æ¯”æ€è·¯</strong>ï¼šæœ€å°è¿æ¥ç®—æ³•å¯ä»¥ç±»æ¯”ä¸ºè¶…å¸‚è´­ç‰©ä¸­é€‰æ‹©æœ€çŸ­é˜Ÿåˆ—ç»“è´¦çš„åœºæ™¯ï¼š</p>
<ul>
<li>é¡¾å®¢ï¼ˆè¯·æ±‚ï¼‰åˆ°è¾¾è¶…å¸‚å‡†å¤‡ç»“è´¦</li>
<li>é¡¾å®¢è§‚å¯Ÿæ‰€æœ‰å¼€æ”¾çš„æ”¶é“¶å°ï¼ˆæœåŠ¡å™¨ï¼‰ï¼ŒæŸ¥çœ‹æ¯ä¸ªé˜Ÿåˆ—çš„é•¿åº¦ï¼ˆè¿æ¥æ•°ï¼‰</li>
<li>é¡¾å®¢é€‰æ‹©æ’é˜Ÿäººæ•°æœ€å°‘çš„æ”¶é“¶å°ï¼ˆè¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨ï¼‰</li>
<li>åœ¨åŠ æƒç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥ç±»æ¯”ä¸ºåŒæ—¶è€ƒè™‘é˜Ÿåˆ—é•¿åº¦å’Œæ”¶é“¶å‘˜æ•ˆç‡ï¼ˆæƒé‡ï¼‰çš„æƒ…å†µâ€”â€”æœ‰äº›æ”¶é“¶å‘˜è™½ç„¶é˜Ÿä¼è¾ƒé•¿ï¼Œä½†å¤„ç†é€Ÿåº¦å¾ˆå¿«ï¼Œå¯èƒ½æ•´ä½“ç­‰å¾…æ—¶é—´æ›´çŸ­</li>
</ul>
<p><strong>åŠ¨æ€è¡Œä¸ºä¸åé¦ˆç³»ç»Ÿ</strong>ï¼šæœ€å°è¿æ¥ç®—æ³•æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå…·æœ‰åé¦ˆæœºåˆ¶çš„åŠ¨æ€ç³»ç»Ÿï¼š</p>
<ul>
<li><strong>è´Ÿåé¦ˆæ§åˆ¶</strong>ï¼šå½“æœåŠ¡å™¨è¿æ¥æ•°å¢åŠ æ—¶ï¼Œè¢«é€‰ä¸­çš„æ¦‚ç‡é™ä½ï¼Œåä¹‹äº¦ç„¶</li>
<li><strong>è‡ªç¨³å®šæ€§</strong>ï¼šç³»ç»Ÿè‡ªåŠ¨å¹³è¡¡å„æœåŠ¡å™¨çš„è´Ÿè½½ï¼Œè¶‹å‘äºå‡è¡¡çŠ¶æ€</li>
<li><strong>é€‚åº”æ€§</strong>ï¼šèƒ½å¤Ÿè‡ªåŠ¨é€‚åº”ä¸åŒæœåŠ¡å™¨çš„å¤„ç†èƒ½åŠ›å·®å¼‚å’Œè¯·æ±‚å¤„ç†æ—¶é—´å˜åŒ–</li>
</ul>
<p><strong>æ‰©å±•åº”ç”¨</strong>ï¼šæœ€å°è¿æ¥ç®—æ³•çš„æ€æƒ³å¯ä»¥æ‰©å±•åˆ°å¤šç§èµ„æºè°ƒåº¦åœºæ™¯ï¼š</p>
<ul>
<li><strong>åˆ†å¸ƒå¼æ•°æ®åº“çš„æŸ¥è¯¢è·¯ç”±</strong>ï¼šå°†æŸ¥è¯¢å‘é€åˆ°è´Ÿè½½è¾ƒè½»çš„æ•°æ®åº“èŠ‚ç‚¹</li>
<li><strong>è™šæ‹Ÿæœº/å®¹å™¨è°ƒåº¦</strong>ï¼šåœ¨äº‘è®¡ç®—ç¯å¢ƒä¸­é€‰æ‹©è´Ÿè½½è¾ƒä½çš„ä¸»æœºéƒ¨ç½²æ–°çš„è™šæ‹Ÿæœºæˆ–å®¹å™¨</li>
<li><strong>ç½‘ç»œæµé‡å·¥ç¨‹</strong>ï¼šé€‰æ‹©æ‹¥å¡ç¨‹åº¦è¾ƒä½çš„è·¯å¾„è½¬å‘æ•°æ®åŒ…</li>
</ul>
<h3 id="æ ¸å¿ƒå®ç°_2">æ ¸å¿ƒå®ç°<a class="headerlink" href="#æ ¸å¿ƒå®ç°_2" title="Permanent link">&para;</a></h3>
<div class="language-go highlight"><span class="filename">Go</span><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><a href="#__codelineno-8-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="c1">// GetServer è·å–è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><a href="#__codelineno-8-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">lb</span><span class="w"> </span><span class="o">*</span><span class="nx">LeastConnectionsLoadBalancer</span><span class="p">)</span><span class="w"> </span><span class="nx">GetServer</span><span class="p">(</span><span class="nx">key</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><a href="#__codelineno-8-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w">    </span><span class="nx">lb</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><a href="#__codelineno-8-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">lb</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><a href="#__codelineno-8-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><a href="#__codelineno-8-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span><span class="c1">// è¿‡æ»¤å‡ºå¯ç”¨çš„æœåŠ¡å™¨</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><a href="#__codelineno-8-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span><span class="nx">availableServers</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="o">*</span><span class="nx">Server</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><a href="#__codelineno-8-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">lb</span><span class="p">.</span><span class="nx">Servers</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a><a href="#__codelineno-8-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">Weight</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a><a href="#__codelineno-8-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">            </span><span class="nx">availableServers</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">availableServers</span><span class="p">,</span><span class="w"> </span><span class="nx">server</span><span class="p">)</span>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a><a href="#__codelineno-8-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a><a href="#__codelineno-8-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a><a href="#__codelineno-8-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-8-14" name="__codelineno-8-14"></a><a href="#__codelineno-8-14"><span class="linenos" data-linenos="14 "></span></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">availableServers</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-15" name="__codelineno-8-15"></a><a href="#__codelineno-8-15"><span class="linenos" data-linenos="15 "></span></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-8-16" name="__codelineno-8-16"></a><a href="#__codelineno-8-16"><span class="linenos" data-linenos="16 "></span></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-8-17" name="__codelineno-8-17"></a><a href="#__codelineno-8-17"><span class="linenos" data-linenos="17 "></span></a>
<a id="__codelineno-8-18" name="__codelineno-8-18"></a><a href="#__codelineno-8-18"><span class="linenos" data-linenos="18 "></span></a><span class="w">    </span><span class="c1">// æ‰¾åˆ°è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨</span>
<a id="__codelineno-8-19" name="__codelineno-8-19"></a><a href="#__codelineno-8-19"><span class="linenos" data-linenos="19 "></span></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">selectedServer</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span>
<a id="__codelineno-8-20" name="__codelineno-8-20"></a><a href="#__codelineno-8-20"><span class="linenos" data-linenos="20 "></span></a><span class="w">    </span><span class="nx">minValue</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">63</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-8-21" name="__codelineno-8-21"></a><a href="#__codelineno-8-21"><span class="linenos" data-linenos="21 "></span></a>
<a id="__codelineno-8-22" name="__codelineno-8-22"></a><a href="#__codelineno-8-22"><span class="linenos" data-linenos="22 "></span></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">availableServers</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-23" name="__codelineno-8-23"></a><a href="#__codelineno-8-23"><span class="linenos" data-linenos="23 "></span></a><span class="w">        </span><span class="nx">connPtr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">lb</span><span class="p">.</span><span class="nx">connections</span><span class="p">[</span><span class="nx">server</span><span class="p">]</span>
<a id="__codelineno-8-24" name="__codelineno-8-24"></a><a href="#__codelineno-8-24"><span class="linenos" data-linenos="24 "></span></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">connPtr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-25" name="__codelineno-8-25"></a><a href="#__codelineno-8-25"><span class="linenos" data-linenos="25 "></span></a><span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">conn</span><span class="w"> </span><span class="kt">int64</span>
<a id="__codelineno-8-26" name="__codelineno-8-26"></a><a href="#__codelineno-8-26"><span class="linenos" data-linenos="26 "></span></a><span class="w">            </span><span class="nx">connPtr</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">conn</span>
<a id="__codelineno-8-27" name="__codelineno-8-27"></a><a href="#__codelineno-8-27"><span class="linenos" data-linenos="27 "></span></a><span class="w">            </span><span class="nx">lb</span><span class="p">.</span><span class="nx">connections</span><span class="p">[</span><span class="nx">server</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">connPtr</span>
<a id="__codelineno-8-28" name="__codelineno-8-28"></a><a href="#__codelineno-8-28"><span class="linenos" data-linenos="28 "></span></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-8-29" name="__codelineno-8-29"></a><a href="#__codelineno-8-29"><span class="linenos" data-linenos="29 "></span></a><span class="w">        </span><span class="nx">connections</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">atomic</span><span class="p">.</span><span class="nx">LoadInt64</span><span class="p">(</span><span class="nx">connPtr</span><span class="p">)</span>
<a id="__codelineno-8-30" name="__codelineno-8-30"></a><a href="#__codelineno-8-30"><span class="linenos" data-linenos="30 "></span></a>
<a id="__codelineno-8-31" name="__codelineno-8-31"></a><a href="#__codelineno-8-31"><span class="linenos" data-linenos="31 "></span></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">currentValue</span><span class="w"> </span><span class="kt">float64</span>
<a id="__codelineno-8-32" name="__codelineno-8-32"></a><a href="#__codelineno-8-32"><span class="linenos" data-linenos="32 "></span></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">lb</span><span class="p">.</span><span class="nx">weighted</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-33" name="__codelineno-8-33"></a><a href="#__codelineno-8-33"><span class="linenos" data-linenos="33 "></span></a><span class="w">            </span><span class="c1">// åŠ æƒæœ€å°è¿æ¥ï¼šè€ƒè™‘æƒé‡å› ç´ </span>
<a id="__codelineno-8-34" name="__codelineno-8-34"></a><a href="#__codelineno-8-34"><span class="linenos" data-linenos="34 "></span></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">Weight</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-35" name="__codelineno-8-35"></a><a href="#__codelineno-8-35"><span class="linenos" data-linenos="35 "></span></a><span class="w">                </span><span class="c1">// æƒé‡è¶Šå¤§ï¼ŒåŠ æƒå€¼è¶Šå°ï¼Œè¶Šå®¹æ˜“è¢«é€‰ä¸­</span>
<a id="__codelineno-8-36" name="__codelineno-8-36"></a><a href="#__codelineno-8-36"><span class="linenos" data-linenos="36 "></span></a><span class="w">                </span><span class="nx">currentValue</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="nx">connections</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="nx">server</span><span class="p">.</span><span class="nx">Weight</span><span class="p">)</span>
<a id="__codelineno-8-37" name="__codelineno-8-37"></a><a href="#__codelineno-8-37"><span class="linenos" data-linenos="37 "></span></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-38" name="__codelineno-8-38"></a><a href="#__codelineno-8-38"><span class="linenos" data-linenos="38 "></span></a><span class="w">                </span><span class="c1">// å¦‚æœæƒé‡ä¸º0ï¼Œåˆ™ä½¿ç”¨æœ€å¤§å€¼ï¼Œç¡®ä¿ä¸ä¼šè¢«é€‰ä¸­</span>
<a id="__codelineno-8-39" name="__codelineno-8-39"></a><a href="#__codelineno-8-39"><span class="linenos" data-linenos="39 "></span></a><span class="w">                </span><span class="nx">currentValue</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">63</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-8-40" name="__codelineno-8-40"></a><a href="#__codelineno-8-40"><span class="linenos" data-linenos="40 "></span></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-8-41" name="__codelineno-8-41"></a><a href="#__codelineno-8-41"><span class="linenos" data-linenos="41 "></span></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-42" name="__codelineno-8-42"></a><a href="#__codelineno-8-42"><span class="linenos" data-linenos="42 "></span></a><span class="w">            </span><span class="c1">// éåŠ æƒæœ€å°è¿æ¥</span>
<a id="__codelineno-8-43" name="__codelineno-8-43"></a><a href="#__codelineno-8-43"><span class="linenos" data-linenos="43 "></span></a><span class="w">            </span><span class="nx">currentValue</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="nx">connections</span><span class="p">)</span>
<a id="__codelineno-8-44" name="__codelineno-8-44"></a><a href="#__codelineno-8-44"><span class="linenos" data-linenos="44 "></span></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-8-45" name="__codelineno-8-45"></a><a href="#__codelineno-8-45"><span class="linenos" data-linenos="45 "></span></a>
<a id="__codelineno-8-46" name="__codelineno-8-46"></a><a href="#__codelineno-8-46"><span class="linenos" data-linenos="46 "></span></a><span class="w">        </span><span class="c1">// å¦‚æœå½“å‰å€¼å°äºæœ€å°å€¼ï¼Œé€‰æ‹©æ­¤æœåŠ¡å™¨</span>
<a id="__codelineno-8-47" name="__codelineno-8-47"></a><a href="#__codelineno-8-47"><span class="linenos" data-linenos="47 "></span></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">currentValue</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">minValue</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-48" name="__codelineno-8-48"></a><a href="#__codelineno-8-48"><span class="linenos" data-linenos="48 "></span></a><span class="w">            </span><span class="nx">minValue</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">currentValue</span>
<a id="__codelineno-8-49" name="__codelineno-8-49"></a><a href="#__codelineno-8-49"><span class="linenos" data-linenos="49 "></span></a><span class="w">            </span><span class="nx">selectedServer</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">server</span>
<a id="__codelineno-8-50" name="__codelineno-8-50"></a><a href="#__codelineno-8-50"><span class="linenos" data-linenos="50 "></span></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">currentValue</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">minValue</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">selectedServer</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-51" name="__codelineno-8-51"></a><a href="#__codelineno-8-51"><span class="linenos" data-linenos="51 "></span></a><span class="w">            </span><span class="c1">// å¦‚æœåŠ æƒå€¼ç›¸åŒï¼Œä¼˜å…ˆé€‰æ‹©æƒé‡æ›´é«˜çš„æœåŠ¡å™¨</span>
<a id="__codelineno-8-52" name="__codelineno-8-52"></a><a href="#__codelineno-8-52"><span class="linenos" data-linenos="52 "></span></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">Weight</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="nx">selectedServer</span><span class="p">.</span><span class="nx">Weight</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-53" name="__codelineno-8-53"></a><a href="#__codelineno-8-53"><span class="linenos" data-linenos="53 "></span></a><span class="w">                </span><span class="nx">selectedServer</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">server</span>
<a id="__codelineno-8-54" name="__codelineno-8-54"></a><a href="#__codelineno-8-54"><span class="linenos" data-linenos="54 "></span></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-8-55" name="__codelineno-8-55"></a><a href="#__codelineno-8-55"><span class="linenos" data-linenos="55 "></span></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-8-56" name="__codelineno-8-56"></a><a href="#__codelineno-8-56"><span class="linenos" data-linenos="56 "></span></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-8-57" name="__codelineno-8-57"></a><a href="#__codelineno-8-57"><span class="linenos" data-linenos="57 "></span></a>
<a id="__codelineno-8-58" name="__codelineno-8-58"></a><a href="#__codelineno-8-58"><span class="linenos" data-linenos="58 "></span></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">selectedServer</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-59" name="__codelineno-8-59"></a><a href="#__codelineno-8-59"><span class="linenos" data-linenos="59 "></span></a><span class="w">        </span><span class="c1">// å¢åŠ é€‰ä¸­æœåŠ¡å™¨çš„è¿æ¥æ•°</span>
<a id="__codelineno-8-60" name="__codelineno-8-60"></a><a href="#__codelineno-8-60"><span class="linenos" data-linenos="60 "></span></a><span class="w">        </span><span class="nx">atomic</span><span class="p">.</span><span class="nx">AddInt64</span><span class="p">(</span><span class="nx">lb</span><span class="p">.</span><span class="nx">connections</span><span class="p">[</span><span class="nx">selectedServer</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-8-61" name="__codelineno-8-61"></a><a href="#__codelineno-8-61"><span class="linenos" data-linenos="61 "></span></a><span class="w">        </span><span class="c1">// åŒæ—¶æ›´æ–°Serverç»“æ„ä½“ä¸­çš„CurrentConnectionså­—æ®µï¼Œæ–¹ä¾¿å¤–éƒ¨æŸ¥çœ‹</span>
<a id="__codelineno-8-62" name="__codelineno-8-62"></a><a href="#__codelineno-8-62"><span class="linenos" data-linenos="62 "></span></a><span class="w">        </span><span class="nx">atomic</span><span class="p">.</span><span class="nx">AddInt32</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">selectedServer</span><span class="p">.</span><span class="nx">CurrentConnections</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-8-63" name="__codelineno-8-63"></a><a href="#__codelineno-8-63"><span class="linenos" data-linenos="63 "></span></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-8-64" name="__codelineno-8-64"></a><a href="#__codelineno-8-64"><span class="linenos" data-linenos="64 "></span></a>
<a id="__codelineno-8-65" name="__codelineno-8-65"></a><a href="#__codelineno-8-65"><span class="linenos" data-linenos="65 "></span></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">selectedServer</span>
<a id="__codelineno-8-66" name="__codelineno-8-66"></a><a href="#__codelineno-8-66"><span class="linenos" data-linenos="66 "></span></a><span class="p">}</span>
<a id="__codelineno-8-67" name="__codelineno-8-67"></a><a href="#__codelineno-8-67"><span class="linenos" data-linenos="67 "></span></a>
<a id="__codelineno-8-68" name="__codelineno-8-68"></a><a href="#__codelineno-8-68"><span class="linenos" data-linenos="68 "></span></a><span class="c1">// ReleaseConnection é‡Šæ”¾è¿æ¥</span>
<a id="__codelineno-8-69" name="__codelineno-8-69"></a><a href="#__codelineno-8-69"><span class="linenos" data-linenos="69 "></span></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">lb</span><span class="w"> </span><span class="o">*</span><span class="nx">LeastConnectionsLoadBalancer</span><span class="p">)</span><span class="w"> </span><span class="nx">ReleaseConnection</span><span class="p">(</span><span class="nx">server</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-70" name="__codelineno-8-70"></a><a href="#__codelineno-8-70"><span class="linenos" data-linenos="70 "></span></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-71" name="__codelineno-8-71"></a><a href="#__codelineno-8-71"><span class="linenos" data-linenos="71 "></span></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-8-72" name="__codelineno-8-72"></a><a href="#__codelineno-8-72"><span class="linenos" data-linenos="72 "></span></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-8-73" name="__codelineno-8-73"></a><a href="#__codelineno-8-73"><span class="linenos" data-linenos="73 "></span></a>
<a id="__codelineno-8-74" name="__codelineno-8-74"></a><a href="#__codelineno-8-74"><span class="linenos" data-linenos="74 "></span></a><span class="w">    </span><span class="nx">lb</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<a id="__codelineno-8-75" name="__codelineno-8-75"></a><a href="#__codelineno-8-75"><span class="linenos" data-linenos="75 "></span></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">lb</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<a id="__codelineno-8-76" name="__codelineno-8-76"></a><a href="#__codelineno-8-76"><span class="linenos" data-linenos="76 "></span></a>
<a id="__codelineno-8-77" name="__codelineno-8-77"></a><a href="#__codelineno-8-77"><span class="linenos" data-linenos="77 "></span></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">connPtr</span><span class="p">,</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">lb</span><span class="p">.</span><span class="nx">connections</span><span class="p">[</span><span class="nx">server</span><span class="p">];</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">atomic</span><span class="p">.</span><span class="nx">LoadInt64</span><span class="p">(</span><span class="nx">connPtr</span><span class="p">)</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-78" name="__codelineno-8-78"></a><a href="#__codelineno-8-78"><span class="linenos" data-linenos="78 "></span></a><span class="w">        </span><span class="nx">atomic</span><span class="p">.</span><span class="nx">AddInt64</span><span class="p">(</span><span class="nx">connPtr</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-8-79" name="__codelineno-8-79"></a><a href="#__codelineno-8-79"><span class="linenos" data-linenos="79 "></span></a><span class="w">        </span><span class="c1">// åŒæ—¶æ›´æ–°Serverç»“æ„ä½“ä¸­çš„CurrentConnectionså­—æ®µ</span>
<a id="__codelineno-8-80" name="__codelineno-8-80"></a><a href="#__codelineno-8-80"><span class="linenos" data-linenos="80 "></span></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">CurrentConnections</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-81" name="__codelineno-8-81"></a><a href="#__codelineno-8-81"><span class="linenos" data-linenos="81 "></span></a><span class="w">            </span><span class="nx">atomic</span><span class="p">.</span><span class="nx">AddInt32</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">server</span><span class="p">.</span><span class="nx">CurrentConnections</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-8-82" name="__codelineno-8-82"></a><a href="#__codelineno-8-82"><span class="linenos" data-linenos="82 "></span></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-8-83" name="__codelineno-8-83"></a><a href="#__codelineno-8-83"><span class="linenos" data-linenos="83 "></span></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-8-84" name="__codelineno-8-84"></a><a href="#__codelineno-8-84"><span class="linenos" data-linenos="84 "></span></a><span class="p">}</span>
</code></pre></div>
<h3 id="ä¼˜ç¼ºç‚¹åˆ†æ_2">ä¼˜ç¼ºç‚¹åˆ†æ<a class="headerlink" href="#ä¼˜ç¼ºç‚¹åˆ†æ_2" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>âœ… èƒ½å¤Ÿæ ¹æ®æœåŠ¡å™¨å®æ—¶è´Ÿè½½è‡ªåŠ¨è°ƒæ•´åˆ†é…</td>
<td>âŒ éœ€è¦è·Ÿè¸ªå’Œæ›´æ–°è¿æ¥è®¡æ•°ï¼Œæœ‰ä¸€å®šå¼€é”€</td>
</tr>
<tr>
<td>âœ… å¤„ç†æ—¶é—´ä¸å‡çš„è¯·æ±‚æ—¶æ•ˆæœæ˜¾è‘—</td>
<td>âŒ å®ç°ç•¥å¤æ‚ï¼Œéœ€è¦é¢å¤–çš„è¿æ¥é‡Šæ”¾æœºåˆ¶</td>
</tr>
<tr>
<td>âœ… é…åˆæƒé‡ç³»ç»Ÿæ›´ç²¾å‡†æ§åˆ¶è´Ÿè½½åˆ†é…</td>
<td>âŒ åœ¨é«˜å¹¶å‘åœºæ™¯å¯èƒ½éœ€è¦ç²¾ç»†çš„é”æ§åˆ¶</td>
</tr>
<tr>
<td>âœ… é€‚åˆé•¿è¿æ¥å’Œè®¡ç®—å¯†é›†å‹åº”ç”¨</td>
<td>âŒ éœ€è¦åº”ç”¨å±‚ä¸»åŠ¨è°ƒç”¨è¿æ¥é‡Šæ”¾æ–¹æ³•</td>
</tr>
</tbody>
</table>
<h2 id="4-maglev-ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•-">4. Maglev ä¸€è‡´æ€§å“ˆå¸Œç®—æ³• ğŸ§²<a class="headerlink" href="#4-maglev-ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•-" title="Permanent link">&para;</a></h2>
<h3 id="ç®—æ³•åŸç†_3">ç®—æ³•åŸç†<a class="headerlink" href="#ç®—æ³•åŸç†_3" title="Permanent link">&para;</a></h3>
<p>Maglev ä¸€è‡´æ€§å“ˆå¸Œæ˜¯ Google è®¾è®¡çš„é«˜æ•ˆä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œç”¨äºå¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ä¿è¯å½“æœåŠ¡å™¨èŠ‚ç‚¹å˜æ›´æ—¶ï¼Œå°½å¯èƒ½å°‘çš„è¯·æ±‚è¢«é‡æ–°æ˜ å°„åˆ°ä¸åŒçš„æœåŠ¡å™¨ã€‚</p>
<ul>
<li><strong>ä¸€è‡´æ€§å“ˆå¸ŒåŸºæœ¬åŸç†</strong>ï¼šå°†è¯·æ±‚å’ŒæœåŠ¡å™¨æ˜ å°„åˆ°åŒä¸€ä¸ªå“ˆå¸Œç¯ä¸Š</li>
<li><strong>Maglev æ”¹è¿›</strong>ï¼šä½¿ç”¨æŸ¥æ‰¾è¡¨æ›¿ä»£ä¼ ç»Ÿå“ˆå¸Œç¯ï¼Œæé«˜æŸ¥æ‰¾æ•ˆç‡å’Œåˆ†å¸ƒå‡åŒ€æ€§</li>
<li><strong>ä¸€è‡´æ€§ä¿è¯</strong>ï¼šé€šè¿‡ç²¾å¿ƒè®¾è®¡çš„å“ˆå¸Œç­–ç•¥ï¼Œç¡®ä¿åœ¨æœåŠ¡å™¨åˆ—è¡¨å˜åŒ–æ—¶ï¼Œæœ€å°åŒ–é”®çš„é‡æ–°æ˜ å°„æ¯”ä¾‹</li>
</ul>
<p><strong>Maglev æŸ¥æ‰¾è¡¨æ„å»ºæµç¨‹</strong>ï¼š</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><a href="#__codelineno-9-1"><span class="linenos" data-linenos=" 1 "></span></a>å¼€å§‹
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><a href="#__codelineno-9-2"><span class="linenos" data-linenos=" 2 "></span></a>  â†“
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><a href="#__codelineno-9-3"><span class="linenos" data-linenos=" 3 "></span></a>ä¸ºæ¯ä¸ªæœåŠ¡å™¨ç”Ÿæˆå”¯ä¸€çš„æ’åˆ—æ•°ç»„
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><a href="#__codelineno-9-4"><span class="linenos" data-linenos=" 4 "></span></a>  â”œâ”€â†’ ä½¿ç”¨æœåŠ¡å™¨æ ‡è¯†ç”Ÿæˆå“ˆå¸Œç§å­
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><a href="#__codelineno-9-5"><span class="linenos" data-linenos=" 5 "></span></a>  â””â”€â†’ ä½¿ç”¨ä¸¤ä¸ªç‹¬ç«‹å“ˆå¸Œå‡½æ•°è®¡ç®—æ’åˆ—ä½ç½®
<a id="__codelineno-9-6" name="__codelineno-9-6"></a><a href="#__codelineno-9-6"><span class="linenos" data-linenos=" 6 "></span></a>  â†“
<a id="__codelineno-9-7" name="__codelineno-9-7"></a><a href="#__codelineno-9-7"><span class="linenos" data-linenos=" 7 "></span></a>åˆå§‹åŒ–æŸ¥æ‰¾è¡¨(æ‰€æœ‰ä½ç½®æ ‡è®°ä¸ºç©º)
<a id="__codelineno-9-8" name="__codelineno-9-8"></a><a href="#__codelineno-9-8"><span class="linenos" data-linenos=" 8 "></span></a>  â†“
<a id="__codelineno-9-9" name="__codelineno-9-9"></a><a href="#__codelineno-9-9"><span class="linenos" data-linenos=" 9 "></span></a>å¡«å……æŸ¥æ‰¾è¡¨
<a id="__codelineno-9-10" name="__codelineno-9-10"></a><a href="#__codelineno-9-10"><span class="linenos" data-linenos="10 "></span></a>  â”œâ”€â†’ éå†æ¯ä¸ªæœåŠ¡å™¨çš„æ’åˆ—ä½ç½®
<a id="__codelineno-9-11" name="__codelineno-9-11"></a><a href="#__codelineno-9-11"><span class="linenos" data-linenos="11 "></span></a>  â””â”€â†’ ä¼˜å…ˆè€ƒè™‘æƒé‡é«˜çš„æœåŠ¡å™¨å æ®ä½ç½®
<a id="__codelineno-9-12" name="__codelineno-9-12"></a><a href="#__codelineno-9-12"><span class="linenos" data-linenos="12 "></span></a>  â†“
<a id="__codelineno-9-13" name="__codelineno-9-13"></a><a href="#__codelineno-9-13"><span class="linenos" data-linenos="13 "></span></a>æŸ¥æ‰¾è¿‡ç¨‹
<a id="__codelineno-9-14" name="__codelineno-9-14"></a><a href="#__codelineno-9-14"><span class="linenos" data-linenos="14 "></span></a>  â†“
<a id="__codelineno-9-15" name="__codelineno-9-15"></a><a href="#__codelineno-9-15"><span class="linenos" data-linenos="15 "></span></a>è®¡ç®—è¯·æ±‚keyçš„å“ˆå¸Œå€¼
<a id="__codelineno-9-16" name="__codelineno-9-16"></a><a href="#__codelineno-9-16"><span class="linenos" data-linenos="16 "></span></a>  â†“
<a id="__codelineno-9-17" name="__codelineno-9-17"></a><a href="#__codelineno-9-17"><span class="linenos" data-linenos="17 "></span></a>ä½¿ç”¨å“ˆå¸Œå€¼ç›´æ¥ç´¢å¼•æŸ¥æ‰¾è¡¨è·å–æœåŠ¡å™¨
<a id="__codelineno-9-18" name="__codelineno-9-18"></a><a href="#__codelineno-9-18"><span class="linenos" data-linenos="18 "></span></a>  â†“
<a id="__codelineno-9-19" name="__codelineno-9-19"></a><a href="#__codelineno-9-19"><span class="linenos" data-linenos="19 "></span></a>å¦‚æœä½ç½®ä¸ºç©ºæˆ–æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œåˆ™å°è¯•ä¸´è¿‘ä½ç½®
<a id="__codelineno-9-20" name="__codelineno-9-20"></a><a href="#__codelineno-9-20"><span class="linenos" data-linenos="20 "></span></a>  â†“
<a id="__codelineno-9-21" name="__codelineno-9-21"></a><a href="#__codelineno-9-21"><span class="linenos" data-linenos="21 "></span></a>ç»“æŸ
</code></pre></div>
<h3 id="å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”_3">å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”<a class="headerlink" href="#å¯¹åº”çš„ç»å…¸é—®é¢˜ä¸ç±»æ¯”_3" title="Permanent link">&para;</a></h3>
<p>Maglevä¸€è‡´æ€§å“ˆå¸Œç®—æ³•è§£å†³çš„æ˜¯ç»å…¸çš„<strong>åŠ¨æ€åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èµ„æºæ˜ å°„é—®é¢˜</strong>ï¼Œä¸å¤šä¸ªè®¡ç®—æœºç§‘å­¦é¢†åŸŸæœ‰æ·±åˆ»è”ç³»ï¼š</p>
<ol>
<li><strong>åˆ†å¸ƒå¼å“ˆå¸Œè¡¨(DHT)</strong>ï¼šP2Pç½‘ç»œä¸­ç”¨äºåˆ†å¸ƒå¼æ•°æ®å­˜å‚¨å’ŒæŸ¥è¯¢çš„æ ¸å¿ƒæŠ€æœ¯</li>
<li><strong>æœ€å°åŒ–é‡å“ˆå¸Œ(Minimal Rehashing)</strong>ï¼šå“ˆå¸Œè¡¨åŠ¨æ€æ‰©å±•æ—¶å‡å°‘é”®é‡åˆ†é…çš„é—®é¢˜</li>
<li><strong>åˆ†ç‰‡ä¸åˆ†åŒºç®¡ç†(Sharding and Partitioning)</strong>ï¼šæ•°æ®åº“ç³»ç»Ÿä¸­å°†æ•°æ®åˆ†å¸ƒåˆ°å¤šä¸ªèŠ‚ç‚¹çš„ç­–ç•¥</li>
</ol>
<p><strong>ç±»æ¯”æ€è·¯</strong>ï¼šä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å¯ä»¥ç±»æ¯”ä¸ºåœ†å½¢åŸå¸‚ä¸­çš„é‚®æ”¿æœåŠ¡ï¼š</p>
<ul>
<li>åœ†å½¢åŸå¸‚å‘¨å›´å‡åŒ€åˆ†å¸ƒç€é‚®å±€ï¼ˆæœåŠ¡å™¨èŠ‚ç‚¹ï¼‰</li>
<li>åŸå¸‚ä¸­çš„å±…æ°‘ï¼ˆè¯·æ±‚ï¼‰æ ¹æ®è‡ªå·±çš„åœ°å€ï¼ˆå“ˆå¸Œå€¼ï¼‰è¢«åˆ†é…åˆ°æœ€è¿‘çš„é‚®å±€</li>
<li>å½“æŸä¸ªé‚®å±€å…³é—­ï¼ˆèŠ‚ç‚¹ç§»é™¤ï¼‰ï¼Œåªæœ‰åŸæœ¬ç”±è¯¥é‚®å±€æœåŠ¡çš„å±…æ°‘éœ€è¦é‡æ–°åˆ†é…åˆ°å…¶ä»–é‚®å±€</li>
<li>å½“æ–°é‚®å±€å¼€è®¾ï¼ˆèŠ‚ç‚¹æ·»åŠ ï¼‰ï¼Œå®ƒåªä¼šæ¥ç®¡é™„è¿‘ä¸€éƒ¨åˆ†å±…æ°‘ï¼Œè€Œä¸å½±å“è¿œå¤„å±…æ°‘ä¸å…¶åŸé‚®å±€çš„å…³ç³»</li>
</ul>
<p><strong>Maglevçš„åˆ›æ–°</strong>ï¼šä¼ ç»Ÿä¸€è‡´æ€§å“ˆå¸Œå­˜åœ¨åˆ†å¸ƒä¸å‡çš„é—®é¢˜ï¼ŒMaglevé€šè¿‡æŸ¥æ‰¾è¡¨è§£å†³äº†è¿™ä¸€é—®é¢˜ï¼š</p>
<ul>
<li><strong>ä¼ ç»Ÿä¸€è‡´æ€§å“ˆå¸Œ</strong>ï¼šç±»ä¼¼äºåœ¨åœ†å‘¨ä¸Šéšæœºæ”¾ç½®é‚®å±€ï¼Œå¯èƒ½å¯¼è‡´æŸäº›åŒºåŸŸé‚®å±€å¯†é›†ï¼ŒæŸäº›åŒºåŸŸé‚®å±€ç¨€ç–</li>
<li><strong>è™šæ‹ŸèŠ‚ç‚¹</strong>ï¼šä¼ ç»Ÿè§£å†³æ–¹æ¡ˆæ˜¯æ¯ä¸ªçœŸå®é‚®å±€è®¾ç«‹å¤šä¸ª"åˆ†å±€"ï¼Œæé«˜å‡åŒ€æ€§ï¼Œä½†å¢åŠ äº†å†…å­˜å¼€é”€</li>
<li><strong>Maglevæ”¹è¿›</strong>ï¼šæå‰è®¡ç®—å¥½æ‰€æœ‰å¯èƒ½åœ°å€çš„æœ€ä½³é‚®å±€ï¼ˆæŸ¥æ‰¾è¡¨ï¼‰ï¼Œå®ç°å¸¸æ•°æ—¶é—´æŸ¥æ‰¾å’Œæ›´å‡åŒ€çš„åˆ†å¸ƒ</li>
</ul>
<p><strong>æ•°å­¦æœ¬è´¨</strong>ï¼šä»æ•°å­¦è§’åº¦çœ‹ï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æ˜¯åœ¨è§£å†³åŠ¨æ€é›†åˆä¸Šçš„åˆ†é…é—®é¢˜ï¼Œç›®æ ‡æ˜¯åœ¨é›†åˆå˜åŒ–æ—¶æœ€å°åŒ–é‡åˆ†é…çš„æ•°é‡ã€‚Maglevé€šè¿‡ç²¾å¿ƒè®¾è®¡çš„æ’åˆ—ç®—æ³•å’Œå¡«å……ç­–ç•¥ï¼Œåœ¨ä¿æŒä¸€è‡´æ€§çš„åŒæ—¶æé«˜äº†åˆ†å¸ƒçš„å‡åŒ€æ€§ã€‚</p>
<p><strong>æ‰©å±•åº”ç”¨</strong>ï¼šMaglevä¸€è‡´æ€§å“ˆå¸Œçš„æ€æƒ³å·²è¢«åº”ç”¨äºå¤šä¸ªé¢†åŸŸï¼š</p>
<ul>
<li><strong>å†…å®¹åˆ†å‘ç½‘ç»œ(CDN)</strong>ï¼šå°†ç”¨æˆ·è¯·æ±‚è·¯ç”±åˆ°æœ€è¿‘çš„ç¼“å­˜æœåŠ¡å™¨</li>
<li><strong>åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿ</strong>ï¼šç¡®å®šæ•°æ®åº”è¯¥å­˜å‚¨åœ¨å“ªä¸ªèŠ‚ç‚¹</li>
<li><strong>å¾®æœåŠ¡æ¶æ„</strong>ï¼šå®ç°æœåŠ¡å‘ç°å’Œè¯·æ±‚è·¯ç”±</li>
<li><strong>å¤§è§„æ¨¡åˆ†å¸ƒå¼ç¼“å­˜</strong>ï¼šå¦‚Memcachedå’ŒRedisé›†ç¾¤</li>
</ul>
<h3 id="æ ¸å¿ƒå®ç°_3">æ ¸å¿ƒå®ç°<a class="headerlink" href="#æ ¸å¿ƒå®ç°_3" title="Permanent link">&para;</a></h3>
<p>Maglev ä¸€è‡´æ€§å“ˆå¸Œçš„æ ¸å¿ƒæ˜¯æ„å»ºå’ŒæŸ¥è¯¢æŸ¥æ‰¾è¡¨ï¼š</p>
<div class="language-go highlight"><span class="filename">Go</span><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><a href="#__codelineno-10-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="c1">// GetServer æ ¹æ®keyè·å–æœåŠ¡å™¨</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><a href="#__codelineno-10-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">lb</span><span class="w"> </span><span class="o">*</span><span class="nx">MaglevHashLoadBalancer</span><span class="p">)</span><span class="w"> </span><span class="nx">GetServer</span><span class="p">(</span><span class="nx">key</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><a href="#__codelineno-10-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w">    </span><span class="nx">lb</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">RLock</span><span class="p">()</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><a href="#__codelineno-10-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">lb</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">RUnlock</span><span class="p">()</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><a href="#__codelineno-10-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><a href="#__codelineno-10-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">lb</span><span class="p">.</span><span class="nx">Servers</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><a href="#__codelineno-10-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><a href="#__codelineno-10-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a><a href="#__codelineno-10-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a><a href="#__codelineno-10-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">    </span><span class="c1">// ä½¿ç”¨keyè®¡ç®—å“ˆå¸Œå€¼</span>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a><a href="#__codelineno-10-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">    </span><span class="nx">hash</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">murmur3</span><span class="p">.</span><span class="nx">Sum64</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span>
<a id="__codelineno-10-12" name="__codelineno-10-12"></a><a href="#__codelineno-10-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">    </span><span class="nx">index</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="nx">hash</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nb">uint64</span><span class="p">(</span><span class="nx">lb</span><span class="p">.</span><span class="nx">tableSize</span><span class="p">))</span>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a><a href="#__codelineno-10-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">    </span><span class="nx">serverIndex</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">lb</span><span class="p">.</span><span class="nx">lookupTable</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span>
<a id="__codelineno-10-14" name="__codelineno-10-14"></a><a href="#__codelineno-10-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-10-15" name="__codelineno-10-15"></a><a href="#__codelineno-10-15"><span class="linenos" data-linenos="15 "></span></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">serverIndex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">serverIndex</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">lb</span><span class="p">.</span><span class="nx">Servers</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">lb</span><span class="p">.</span><span class="nx">Servers</span><span class="p">[</span><span class="nx">serverIndex</span><span class="p">].</span><span class="nx">Weight</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-16" name="__codelineno-10-16"></a><a href="#__codelineno-10-16"><span class="linenos" data-linenos="16 "></span></a><span class="w">        </span><span class="c1">// å¦‚æœæŸ¥æ‰¾è¡¨ä¸­æ²¡æœ‰å¯¹åº”çš„æœåŠ¡å™¨ï¼Œæˆ–è€…æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œ</span>
<a id="__codelineno-10-17" name="__codelineno-10-17"></a><a href="#__codelineno-10-17"><span class="linenos" data-linenos="17 "></span></a><span class="w">        </span><span class="c1">// å°è¯•æŸ¥æ‰¾è¡¨ä¸­çš„å…¶ä»–ä½ç½®</span>
<a id="__codelineno-10-18" name="__codelineno-10-18"></a><a href="#__codelineno-10-18"><span class="linenos" data-linenos="18 "></span></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">offset</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="nx">offset</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span><span class="w"> </span><span class="nx">offset</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-19" name="__codelineno-10-19"></a><a href="#__codelineno-10-19"><span class="linenos" data-linenos="19 "></span></a><span class="w">            </span><span class="nx">newIndex</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">(</span><span class="nx">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">offset</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nx">lb</span><span class="p">.</span><span class="nx">tableSize</span>
<a id="__codelineno-10-20" name="__codelineno-10-20"></a><a href="#__codelineno-10-20"><span class="linenos" data-linenos="20 "></span></a><span class="w">            </span><span class="nx">serverIndex</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">lb</span><span class="p">.</span><span class="nx">lookupTable</span><span class="p">[</span><span class="nx">newIndex</span><span class="p">]</span>
<a id="__codelineno-10-21" name="__codelineno-10-21"></a><a href="#__codelineno-10-21"><span class="linenos" data-linenos="21 "></span></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">serverIndex</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">serverIndex</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">lb</span><span class="p">.</span><span class="nx">Servers</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">lb</span><span class="p">.</span><span class="nx">Servers</span><span class="p">[</span><span class="nx">serverIndex</span><span class="p">].</span><span class="nx">Weight</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-22" name="__codelineno-10-22"></a><a href="#__codelineno-10-22"><span class="linenos" data-linenos="22 "></span></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">lb</span><span class="p">.</span><span class="nx">Servers</span><span class="p">[</span><span class="nx">serverIndex</span><span class="p">]</span>
<a id="__codelineno-10-23" name="__codelineno-10-23"></a><a href="#__codelineno-10-23"><span class="linenos" data-linenos="23 "></span></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-10-24" name="__codelineno-10-24"></a><a href="#__codelineno-10-24"><span class="linenos" data-linenos="24 "></span></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-10-25" name="__codelineno-10-25"></a><a href="#__codelineno-10-25"><span class="linenos" data-linenos="25 "></span></a>
<a id="__codelineno-10-26" name="__codelineno-10-26"></a><a href="#__codelineno-10-26"><span class="linenos" data-linenos="26 "></span></a><span class="w">        </span><span class="c1">// å¦‚æœä»æœªæ‰¾åˆ°ï¼Œå›é€€åˆ°ç®€å•å“ˆå¸Œ</span>
<a id="__codelineno-10-27" name="__codelineno-10-27"></a><a href="#__codelineno-10-27"><span class="linenos" data-linenos="27 "></span></a><span class="w">        </span><span class="nx">availableServers</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="o">*</span><span class="nx">Server</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-10-28" name="__codelineno-10-28"></a><a href="#__codelineno-10-28"><span class="linenos" data-linenos="28 "></span></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">lb</span><span class="p">.</span><span class="nx">Servers</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-29" name="__codelineno-10-29"></a><a href="#__codelineno-10-29"><span class="linenos" data-linenos="29 "></span></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">Weight</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-30" name="__codelineno-10-30"></a><a href="#__codelineno-10-30"><span class="linenos" data-linenos="30 "></span></a><span class="w">                </span><span class="nx">availableServers</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">availableServers</span><span class="p">,</span><span class="w"> </span><span class="nx">server</span><span class="p">)</span>
<a id="__codelineno-10-31" name="__codelineno-10-31"></a><a href="#__codelineno-10-31"><span class="linenos" data-linenos="31 "></span></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-10-32" name="__codelineno-10-32"></a><a href="#__codelineno-10-32"><span class="linenos" data-linenos="32 "></span></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-10-33" name="__codelineno-10-33"></a><a href="#__codelineno-10-33"><span class="linenos" data-linenos="33 "></span></a>
<a id="__codelineno-10-34" name="__codelineno-10-34"></a><a href="#__codelineno-10-34"><span class="linenos" data-linenos="34 "></span></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">availableServers</span><span class="p">)</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-35" name="__codelineno-10-35"></a><a href="#__codelineno-10-35"><span class="linenos" data-linenos="35 "></span></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">availableServers</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nx">hash</span><span class="o">%</span><span class="nb">uint64</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">availableServers</span><span class="p">)))]</span>
<a id="__codelineno-10-36" name="__codelineno-10-36"></a><a href="#__codelineno-10-36"><span class="linenos" data-linenos="36 "></span></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-10-37" name="__codelineno-10-37"></a><a href="#__codelineno-10-37"><span class="linenos" data-linenos="37 "></span></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-10-38" name="__codelineno-10-38"></a><a href="#__codelineno-10-38"><span class="linenos" data-linenos="38 "></span></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-10-39" name="__codelineno-10-39"></a><a href="#__codelineno-10-39"><span class="linenos" data-linenos="39 "></span></a>
<a id="__codelineno-10-40" name="__codelineno-10-40"></a><a href="#__codelineno-10-40"><span class="linenos" data-linenos="40 "></span></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">lb</span><span class="p">.</span><span class="nx">Servers</span><span class="p">[</span><span class="nx">serverIndex</span><span class="p">]</span>
<a id="__codelineno-10-41" name="__codelineno-10-41"></a><a href="#__codelineno-10-41"><span class="linenos" data-linenos="41 "></span></a><span class="p">}</span>
</code></pre></div>
<p>æ„å»ºæŸ¥æ‰¾è¡¨æ˜¯ Maglev ç®—æ³•æœ€å…³é”®çš„éƒ¨åˆ†ï¼Œå®ƒé€šè¿‡å¤æ‚çš„æ’åˆ—ç®—æ³•ç¡®ä¿èŠ‚ç‚¹å˜åŒ–æ—¶æœ€å°åŒ–é‡æ–°æ˜ å°„ï¼š</p>
<div class="language-go highlight"><span class="filename">Go</span><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><a href="#__codelineno-11-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="c1">// permutation è®¡ç®—æœåŠ¡å™¨åœ¨æŸ¥æ‰¾è¡¨ä¸­çš„ä½ç½®</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><a href="#__codelineno-11-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">lb</span><span class="w"> </span><span class="o">*</span><span class="nx">MaglevHashLoadBalancer</span><span class="p">)</span><span class="w"> </span><span class="nx">permutation</span><span class="p">(</span><span class="nx">serverIndex</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><a href="#__codelineno-11-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w">    </span><span class="c1">// ä½¿ç”¨æœåŠ¡å™¨åœ°å€å’Œç´¢å¼•ç»“åˆè®¡ç®—å“ˆå¸Œå€¼ï¼Œå¢åŠ å¤šæ ·æ€§</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><a href="#__codelineno-11-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">    </span><span class="nx">server</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">lb</span><span class="p">.</span><span class="nx">Servers</span><span class="p">[</span><span class="nx">serverIndex</span><span class="p">]</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><a href="#__codelineno-11-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">    </span><span class="nx">uniqueKey</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">Address</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;:&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nb">rune</span><span class="p">(</span><span class="nx">serverIndex</span><span class="p">))</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><a href="#__codelineno-11-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><a href="#__codelineno-11-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span><span class="c1">// ä¼˜åŒ–å“ˆå¸Œç§å­è®¡ç®—</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><a href="#__codelineno-11-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">    </span><span class="nx">offset</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">murmur3</span><span class="p">.</span><span class="nx">Sum64</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">uniqueKey</span><span class="p">))</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nb">uint64</span><span class="p">(</span><span class="nx">lb</span><span class="p">.</span><span class="nx">tableSize</span><span class="p">)</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a><a href="#__codelineno-11-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="w">    </span><span class="nx">skip</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">xxh3</span><span class="p">.</span><span class="nx">Hash</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">uniqueKey</span><span class="p">))</span><span class="o">%</span><span class="nb">uint64</span><span class="p">(</span><span class="nx">lb</span><span class="p">.</span><span class="nx">tableSize</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><a href="#__codelineno-11-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a><a href="#__codelineno-11-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">    </span><span class="nx">weight</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">Weight</span>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a><a href="#__codelineno-11-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">weight</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-13" name="__codelineno-11-13"></a><a href="#__codelineno-11-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">        </span><span class="nx">weight</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="c1">// ç¡®ä¿è‡³å°‘æœ‰æƒé‡1ï¼Œé¿å…é™¤é›¶é”™è¯¯</span>
<a id="__codelineno-11-14" name="__codelineno-11-14"></a><a href="#__codelineno-11-14"><span class="linenos" data-linenos="14 "></span></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-11-15" name="__codelineno-11-15"></a><a href="#__codelineno-11-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-11-16" name="__codelineno-11-16"></a><a href="#__codelineno-11-16"><span class="linenos" data-linenos="16 "></span></a><span class="w">    </span><span class="c1">// è€ƒè™‘æƒé‡å› ç´ ï¼Œå½±å“æ’åˆ—çš„ç”Ÿæˆ</span>
<a id="__codelineno-11-17" name="__codelineno-11-17"></a><a href="#__codelineno-11-17"><span class="linenos" data-linenos="17 "></span></a><span class="w">    </span><span class="nx">perm</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">lb</span><span class="p">.</span><span class="nx">tableSize</span><span class="p">)</span>
<a id="__codelineno-11-18" name="__codelineno-11-18"></a><a href="#__codelineno-11-18"><span class="linenos" data-linenos="18 "></span></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">lb</span><span class="p">.</span><span class="nx">tableSize</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-19" name="__codelineno-11-19"></a><a href="#__codelineno-11-19"><span class="linenos" data-linenos="19 "></span></a><span class="w">        </span><span class="c1">// æ ¹æ®æƒé‡è°ƒæ•´åç§»é‡ï¼Œæƒé‡å¤§çš„æœåŠ¡å™¨æœ‰æ›´å¤šæœºä¼šè¢«é€‰ä¸­</span>
<a id="__codelineno-11-20" name="__codelineno-11-20"></a><a href="#__codelineno-11-20"><span class="linenos" data-linenos="20 "></span></a><span class="w">        </span><span class="nx">adjustedOffset</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">(</span><span class="nx">offset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">uint64</span><span class="p">(</span><span class="nx">i</span><span class="o">*</span><span class="nx">weight</span><span class="p">))</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nb">uint64</span><span class="p">(</span><span class="nx">lb</span><span class="p">.</span><span class="nx">tableSize</span><span class="p">)</span>
<a id="__codelineno-11-21" name="__codelineno-11-21"></a><a href="#__codelineno-11-21"><span class="linenos" data-linenos="21 "></span></a><span class="w">        </span><span class="nx">perm</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">int</span><span class="p">((</span><span class="nx">adjustedOffset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">uint64</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span><span class="o">*</span><span class="nx">skip</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nb">uint64</span><span class="p">(</span><span class="nx">lb</span><span class="p">.</span><span class="nx">tableSize</span><span class="p">))</span>
<a id="__codelineno-11-22" name="__codelineno-11-22"></a><a href="#__codelineno-11-22"><span class="linenos" data-linenos="22 "></span></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-11-23" name="__codelineno-11-23"></a><a href="#__codelineno-11-23"><span class="linenos" data-linenos="23 "></span></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">perm</span>
<a id="__codelineno-11-24" name="__codelineno-11-24"></a><a href="#__codelineno-11-24"><span class="linenos" data-linenos="24 "></span></a><span class="p">}</span>
</code></pre></div>
<h3 id="ä¼˜ç¼ºç‚¹åˆ†æ_3">ä¼˜ç¼ºç‚¹åˆ†æ<a class="headerlink" href="#ä¼˜ç¼ºç‚¹åˆ†æ_3" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>âœ… æœåŠ¡å™¨å˜åŒ–æ—¶æœ€å°åŒ–è¯·æ±‚é‡æ–°æ˜ å°„</td>
<td>âŒ å®ç°å¤æ‚åº¦é«˜</td>
</tr>
<tr>
<td>âœ… æŸ¥æ‰¾æ€§èƒ½é«˜ï¼ŒO(1)æ—¶é—´å¤æ‚åº¦</td>
<td>âŒ å†…å­˜å ç”¨è¾ƒå¤§ï¼Œéœ€è¦ç»´æŠ¤æŸ¥æ‰¾è¡¨</td>
</tr>
<tr>
<td>âœ… é€‚åˆéœ€è¦ä¼šè¯ç²˜æ€§çš„åœºæ™¯</td>
<td>âŒ åˆå§‹åŒ–å’Œæ›´æ–°æŸ¥æ‰¾è¡¨å¼€é”€è¾ƒå¤§</td>
</tr>
<tr>
<td>âœ… æ”¯æŒæœåŠ¡å™¨åŠ¨æ€å¢å‡</td>
<td>âŒ éœ€è¦ä½¿ç”¨é«˜è´¨é‡çš„å“ˆå¸Œå‡½æ•°</td>
</tr>
<tr>
<td>âœ… åˆ†å¸ƒå‡åŒ€æ€§å¥½äºä¼ ç»Ÿä¸€è‡´æ€§å“ˆå¸Œ</td>
<td>âŒ å‚æ•°è°ƒä¼˜è¾ƒä¸ºå¤æ‚</td>
</tr>
</tbody>
</table>
<h2 id="5-ç®—æ³•å¯¹æ¯”ä¸å®è·µå»ºè®®-">5. ç®—æ³•å¯¹æ¯”ä¸å®è·µå»ºè®® ğŸ“Š<a class="headerlink" href="#5-ç®—æ³•å¯¹æ¯”ä¸å®è·µå»ºè®®-" title="Permanent link">&para;</a></h2>
<h3 id="å››ç§ç®—æ³•å¯¹æ¯”-">å››ç§ç®—æ³•å¯¹æ¯” ğŸ”<a class="headerlink" href="#å››ç§ç®—æ³•å¯¹æ¯”-" title="Permanent link">&para;</a></h3>
<p>ä¸‹è¡¨å…¨é¢å¯¹æ¯”äº†å››ç§è´Ÿè½½å‡è¡¡ç®—æ³•çš„ä¸»è¦ç‰¹æ€§ï¼š</p>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>éšæœºé€‰æ‹©</th>
<th>è½®è¯¢</th>
<th>æœ€å°è¿æ¥</th>
<th>Maglevä¸€è‡´æ€§å“ˆå¸Œ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æ—¶é—´å¤æ‚åº¦</strong></td>
<td>O(1)</td>
<td>O(1)</td>
<td>O(n)</td>
<td>O(1)</td>
</tr>
<tr>
<td><strong>ç©ºé—´å¤æ‚åº¦</strong></td>
<td>O(n)</td>
<td>O(n)</td>
<td>O(n)</td>
<td>O(m)</td>
</tr>
<tr>
<td><strong>å‡è¡¡æ€§</strong></td>
<td>ä¸­</td>
<td>é«˜</td>
<td>é«˜</td>
<td>ä¸­</td>
</tr>
<tr>
<td><strong>ä¸€è‡´æ€§</strong></td>
<td>ä½</td>
<td>ä½</td>
<td>ä¸­</td>
<td>é«˜</td>
</tr>
<tr>
<td><strong>çŠ¶æ€ç»´æŠ¤</strong></td>
<td>æ— </td>
<td>è½»é‡</td>
<td>é‡</td>
<td>é‡</td>
</tr>
<tr>
<td><strong>å®ç°å¤æ‚åº¦</strong></td>
<td>â­</td>
<td>â­â­</td>
<td>â­â­â­</td>
<td>â­â­â­â­</td>
</tr>
<tr>
<td><strong>å¯¹æœåŠ¡å™¨å˜åŒ–æ•æ„Ÿåº¦</strong></td>
<td>ä½</td>
<td>ä¸­</td>
<td>ä½</td>
<td>é«˜</td>
</tr>
<tr>
<td><strong>é€‚åˆè¯·æ±‚ç±»å‹</strong></td>
<td>çŸ­è¿æ¥</td>
<td>çŸ­è¿æ¥</td>
<td>é•¿è¿æ¥</td>
<td>æ‰€æœ‰ç±»å‹</td>
</tr>
<tr>
<td><strong>å†…å­˜å ç”¨</strong></td>
<td>ä½</td>
<td>ä½</td>
<td>ä¸­</td>
<td>é«˜</td>
</tr>
<tr>
<td><strong>é€‚ç”¨åœºæ™¯</strong></td>
<td>ç®€å•ç³»ç»Ÿ<br>æœåŠ¡å™¨æ€§èƒ½ä¸€è‡´</td>
<td>æœåŠ¡å™¨è´Ÿè½½å‡è¡¡<br>æ€§èƒ½æ¥è¿‘</td>
<td>é•¿è¿æ¥<br>å¤„ç†æ—¶é—´ä¸å‡</td>
<td>ä¼šè¯ç²˜æ€§<br>ç¼“å­˜ä¸€è‡´æ€§</td>
</tr>
</tbody>
</table>
<p>ï¼ˆå…¶ä¸­ n ä¸ºæœåŠ¡å™¨æ•°é‡ï¼Œm ä¸ºæŸ¥æ‰¾è¡¨å¤§å°ï¼‰</p>
<h3 id="å®è·µå»ºè®®-">å®è·µå»ºè®® ğŸ› ï¸<a class="headerlink" href="#å®è·µå»ºè®®-" title="Permanent link">&para;</a></h3>
<p>åŸºäºä»¥ä¸Šå¯¹æ¯”ï¼Œæˆ‘ä»¬å¯ä»¥é’ˆå¯¹ä¸åŒåœºæ™¯ç»™å‡ºä»¥ä¸‹å»ºè®®ï¼š</p>
<ol>
<li>
<p><strong>çŸ­è¿æ¥ã€æœåŠ¡å™¨å‡è´¨åœºæ™¯</strong>ï¼šéšæœºæˆ–è½®è¯¢ç®—æ³•è¶³å¤Ÿ</p>
<ul>
<li>ä¾‹å¦‚ï¼šé™æ€èµ„æºæœåŠ¡å™¨ã€ç®€å•çš„APIç½‘å…³</li>
</ul>
</li>
<li>
<p><strong>é•¿è¿æ¥ã€å¤„ç†æ—¶é—´ä¸å‡</strong>ï¼šæœ€å°è¿æ¥ç®—æ³•æ•ˆæœè¾ƒå¥½</p>
<ul>
<li>ä¾‹å¦‚ï¼šæ•°æ®åº“è¿æ¥æ± ã€WebSocketæœåŠ¡</li>
</ul>
</li>
<li>
<p><strong>éœ€è¦ä¼šè¯ä¸€è‡´æ€§</strong>ï¼šä½¿ç”¨Maglevä¸€è‡´æ€§å“ˆå¸Œ</p>
<ul>
<li>ä¾‹å¦‚ï¼šæœ‰çŠ¶æ€æœåŠ¡ã€åˆ†å¸ƒå¼ç¼“å­˜ã€ç”¨æˆ·ä¼šè¯ç®¡ç†</li>
</ul>
</li>
<li>
<p><strong>æ··åˆç­–ç•¥</strong>ï¼šå¯ä»¥ç»„åˆå¤šç§ç­–ç•¥</p>
<ul>
<li>ä¾‹å¦‚ï¼šå…ˆä¸€è‡´æ€§å“ˆå¸Œåˆ†ç»„ï¼Œå†ç”¨æœ€å°è¿æ¥é€‰æ‹©</li>
<li>äºŒçº§è´Ÿè½½å‡è¡¡ï¼šåŒºåŸŸçº§ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œï¼ŒåŒºåŸŸå†…ä½¿ç”¨æœ€å°è¿æ¥</li>
</ul>
</li>
</ol>
<h3 id="çœŸå®ä¸–ç•Œåº”ç”¨æ¡ˆä¾‹-">çœŸå®ä¸–ç•Œåº”ç”¨æ¡ˆä¾‹ ğŸŒ<a class="headerlink" href="#çœŸå®ä¸–ç•Œåº”ç”¨æ¡ˆä¾‹-" title="Permanent link">&para;</a></h3>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›çœŸå®ä¸–ç•Œä¸­çš„åº”ç”¨æ¡ˆä¾‹ï¼Œå±•ç¤ºäº†ä¸åŒè´Ÿè½½å‡è¡¡ç®—æ³•çš„å®é™…åº”ç”¨ï¼š</p>
<h4 id="æ¡ˆä¾‹1cdnè¾¹ç¼˜èŠ‚ç‚¹è°ƒåº¦">æ¡ˆä¾‹1ï¼šCDNè¾¹ç¼˜èŠ‚ç‚¹è°ƒåº¦<a class="headerlink" href="#æ¡ˆä¾‹1cdnè¾¹ç¼˜èŠ‚ç‚¹è°ƒåº¦" title="Permanent link">&para;</a></h4>
<p><strong>åœºæ™¯</strong>ï¼šå…¨çƒæ€§å†…å®¹åˆ†å‘ç½‘ç»œ(CDN)éœ€è¦å°†ç”¨æˆ·è¯·æ±‚åˆ†å‘åˆ°æœ€è¿‘çš„è¾¹ç¼˜èŠ‚ç‚¹</p>
<p><strong>é€‰æ‹©ç®—æ³•</strong>ï¼šä¸€è‡´æ€§å“ˆå¸Œ + åœ°ç†ä½ç½®æ„ŸçŸ¥</p>
<p><strong>åŸå› </strong>ï¼š</p>
<ul>
<li>ç›¸åŒç”¨æˆ·çš„è¯·æ±‚åº”è¯¥è·¯ç”±åˆ°ç›¸åŒçš„è¾¹ç¼˜èŠ‚ç‚¹ï¼Œæé«˜ç¼“å­˜å‘½ä¸­ç‡</li>
<li>å½“æŸä¸ªèŠ‚ç‚¹å¤±æ•ˆæ—¶ï¼Œåªæœ‰è¯¥èŠ‚ç‚¹çš„è¯·æ±‚éœ€è¦é‡æ–°æ˜ å°„</li>
<li>ç»“åˆåœ°ç†ä½ç½®ä¿¡æ¯å¯ä»¥ä¼˜å…ˆé€‰æ‹©ç‰©ç†è·ç¦»è¿‘çš„èŠ‚ç‚¹</li>
</ul>
<h4 id="æ¡ˆä¾‹2apiç½‘å…³">æ¡ˆä¾‹2ï¼šAPIç½‘å…³<a class="headerlink" href="#æ¡ˆä¾‹2apiç½‘å…³" title="Permanent link">&para;</a></h4>
<p><strong>åœºæ™¯</strong>ï¼šä¼ä¸šçº§å¾®æœåŠ¡æ¶æ„çš„APIç½‘å…³éœ€è¦åˆ†å‘å¤§é‡çŸ­è¿æ¥è¯·æ±‚åˆ°åç«¯æœåŠ¡</p>
<p><strong>é€‰æ‹©ç®—æ³•</strong>ï¼šåŠ æƒè½®è¯¢</p>
<p><strong>åŸå› </strong>ï¼š
- è¯·æ±‚å¤„ç†æ—¶é—´ç›¸å¯¹ä¸€è‡´
- æœåŠ¡å™¨æ€§èƒ½å¯èƒ½ä¸åŒï¼ˆéœ€è¦æƒé‡æ”¯æŒï¼‰
- å®ç°ç®€å•ï¼Œè®¡ç®—å¼€é”€å°
- åˆ†å¸ƒå‡åŒ€å¯é¢„æµ‹</p>
<h4 id="æ¡ˆä¾‹3æ•°æ®åº“è¯»å†™åˆ†ç¦»">æ¡ˆä¾‹3ï¼šæ•°æ®åº“è¯»å†™åˆ†ç¦»<a class="headerlink" href="#æ¡ˆä¾‹3æ•°æ®åº“è¯»å†™åˆ†ç¦»" title="Permanent link">&para;</a></h4>
<p><strong>åœºæ™¯</strong>ï¼šä¸»ä»æ¶æ„çš„æ•°æ®åº“é›†ç¾¤ï¼Œéœ€è¦å°†è¯»è¯·æ±‚åˆ†æ•£åˆ°å¤šä¸ªä»åº“</p>
<p><strong>é€‰æ‹©ç®—æ³•</strong>ï¼šæœ€å°è¿æ¥</p>
<p><strong>åŸå› </strong>ï¼š</p>
<ul>
<li>æŸ¥è¯¢å¤æ‚åº¦å·®å¼‚å¤§ï¼Œæ‰§è¡Œæ—¶é—´ä¸ä¸€</li>
<li>éœ€è¦åŠ¨æ€é€‚åº”è´Ÿè½½æƒ…å†µ</li>
<li>é¿å…å•ä¸ªä»åº“è¿‡è½½</li>
</ul>
<h4 id="æ¡ˆä¾‹4åˆ†å¸ƒå¼ç¼“å­˜é›†ç¾¤">æ¡ˆä¾‹4ï¼šåˆ†å¸ƒå¼ç¼“å­˜é›†ç¾¤<a class="headerlink" href="#æ¡ˆä¾‹4åˆ†å¸ƒå¼ç¼“å­˜é›†ç¾¤" title="Permanent link">&para;</a></h4>
<p><strong>åœºæ™¯</strong>ï¼šå¤§è§„æ¨¡åˆ†å¸ƒå¼ç¼“å­˜ç³»ç»Ÿï¼ˆå¦‚Redisé›†ç¾¤ï¼‰</p>
<p><strong>é€‰æ‹©ç®—æ³•</strong>ï¼šä¸€è‡´æ€§å“ˆå¸Œ</p>
<p><strong>åŸå› </strong>ï¼š</p>
<ul>
<li>ç›¸åŒçš„é”®éœ€è¦å§‹ç»ˆæ˜ å°„åˆ°ç›¸åŒçš„èŠ‚ç‚¹</li>
<li>é›†ç¾¤æ‰©ç¼©å®¹æ—¶æœ€å°åŒ–ç¼“å­˜å¤±æ•ˆ</li>
<li>æ”¯æŒè™šæ‹ŸèŠ‚ç‚¹å¹³è¡¡è´Ÿè½½</li>
</ul>
<h2 id="6-è´Ÿè½½å‡è¡¡çš„ç†è®ºåŸºç¡€ä¸æœªæ¥å‘å±•-">6. è´Ÿè½½å‡è¡¡çš„ç†è®ºåŸºç¡€ä¸æœªæ¥å‘å±• ğŸ§®<a class="headerlink" href="#6-è´Ÿè½½å‡è¡¡çš„ç†è®ºåŸºç¡€ä¸æœªæ¥å‘å±•-" title="Permanent link">&para;</a></h2>
<h3 id="è´Ÿè½½å‡è¡¡çš„ç†è®ºåŸºç¡€">è´Ÿè½½å‡è¡¡çš„ç†è®ºåŸºç¡€<a class="headerlink" href="#è´Ÿè½½å‡è¡¡çš„ç†è®ºåŸºç¡€" title="Permanent link">&para;</a></h3>
<p>è´Ÿè½½å‡è¡¡ç®—æ³•ä¸ä»…ä»…æ˜¯å®ç”¨æŠ€æœ¯ï¼Œå®ƒä»¬ä¹Ÿæ˜¯å¤šä¸ªè®¡ç®—æœºç§‘å­¦ç†è®ºé¢†åŸŸç ”ç©¶çš„ç„¦ç‚¹ï¼š</p>
<ol>
<li>
<p><strong>æ’é˜Ÿè®º(Queueing Theory)</strong>ï¼šè´Ÿè½½å‡è¡¡æœ¬è´¨ä¸Šæ˜¯è§£å†³å¤šæœåŠ¡å™¨æ’é˜Ÿç³»ç»Ÿçš„æœ€ä¼˜æœåŠ¡åˆ†é…é—®é¢˜ã€‚æ’é˜Ÿè®ºæä¾›äº†åˆ†æç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡ï¼ˆå¦‚å¹³å‡ç­‰å¾…æ—¶é—´ã€ç³»ç»Ÿååé‡ï¼‰çš„æ•°å­¦å·¥å…·ã€‚</p>
</li>
<li>
<p><strong>åšå¼ˆè®º(Game Theory)</strong>ï¼šå½“ç³»ç»Ÿä¸­å­˜åœ¨å¤šä¸ªç‹¬ç«‹å†³ç­–è€…ï¼ˆå¦‚åˆ†å¸ƒå¼è´Ÿè½½å‡è¡¡ï¼‰æ—¶ï¼Œå¯ä»¥åº”ç”¨åšå¼ˆè®ºåˆ†æç³»ç»Ÿçš„å‡è¡¡çŠ¶æ€å’Œç¨³å®šæ€§ã€‚</p>
</li>
<li>
<p><strong>æ§åˆ¶è®º(Control Theory)</strong>ï¼šæœ€å°è¿æ¥ç®—æ³•å®é™…ä¸Šæ˜¯ä¸€ä¸ªè´Ÿåé¦ˆæ§åˆ¶ç³»ç»Ÿï¼Œé€šè¿‡åŠ¨æ€è°ƒæ•´è¯·æ±‚åˆ†é…æ¥å¹³è¡¡æœåŠ¡å™¨è´Ÿè½½ã€‚</p>
</li>
<li>
<p><strong>éšæœºè¿‡ç¨‹(Stochastic Processes)</strong>ï¼šéšæœºè´Ÿè½½å‡è¡¡ç®—æ³•å¯ä»¥é€šè¿‡é©¬å°”å¯å¤«è¿‡ç¨‹ã€æ³Šæ¾è¿‡ç¨‹ç­‰éšæœºè¿‡ç¨‹ç†è®ºæ¥åˆ†æå…¶é•¿æœŸè¡Œä¸ºã€‚</p>
</li>
<li>
<p><strong>åˆ†å¸ƒå¼ç³»ç»Ÿç†è®º(Distributed Systems Theory)</strong>ï¼šä¸€è‡´æ€§å“ˆå¸Œç­‰ç®—æ³•è§£å†³äº†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ•°æ®åˆ†åŒºå’Œè¯·æ±‚è·¯ç”±é—®é¢˜ï¼Œä¸CAPå®šç†ã€æœ€ç»ˆä¸€è‡´æ€§ç­‰æ¦‚å¿µå¯†åˆ‡ç›¸å…³ã€‚</p>
</li>
</ol>
<h3 id="è´Ÿè½½å‡è¡¡æŠ€æœ¯çš„æ–°è¶‹åŠ¿">è´Ÿè½½å‡è¡¡æŠ€æœ¯çš„æ–°è¶‹åŠ¿<a class="headerlink" href="#è´Ÿè½½å‡è¡¡æŠ€æœ¯çš„æ–°è¶‹åŠ¿" title="Permanent link">&para;</a></h3>
<p>éšç€æŠ€æœ¯çš„å‘å±•ï¼Œè´Ÿè½½å‡è¡¡ç®—æ³•ä¹Ÿåœ¨ä¸æ–­æ¼”è¿›ï¼š</p>
<ol>
<li>
<p><strong>æœºå™¨å­¦ä¹ è¾…åŠ©è´Ÿè½½å‡è¡¡</strong>ï¼šåˆ©ç”¨é¢„æµ‹æ¨¡å‹åŠ¨æ€è°ƒæ•´è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ŒåŸºäºå†å²æ€§èƒ½æ•°æ®å’Œå½“å‰ç³»ç»ŸçŠ¶æ€åšå‡ºæ›´æ™ºèƒ½çš„è·¯ç”±å†³ç­–ã€‚</p>
</li>
<li>
<p><strong>åº”ç”¨æ„ŸçŸ¥è´Ÿè½½å‡è¡¡(Application-Aware Load Balancing)</strong>ï¼šæ·±å…¥ç†è§£åº”ç”¨å±‚è´Ÿè½½ç‰¹å¾ï¼Œè€ƒè™‘è¯·æ±‚ç±»å‹ã€èµ„æºéœ€æ±‚ç­‰å› ç´ è¿›è¡Œæ›´ç²¾ç»†åŒ–çš„è´Ÿè½½åˆ†é…ã€‚</p>
</li>
<li>
<p><strong>è¾¹ç¼˜è®¡ç®—è´Ÿè½½å‡è¡¡</strong>ï¼šåœ¨é è¿‘ç”¨æˆ·çš„è¾¹ç¼˜èŠ‚ç‚¹è¿›è¡Œè´Ÿè½½å‡è¡¡å†³ç­–ï¼Œå‡å°‘å»¶è¿Ÿï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚</p>
</li>
<li>
<p><strong>å¤šç›®æ ‡ä¼˜åŒ–</strong>ï¼šåŒæ—¶è€ƒè™‘å»¶è¿Ÿã€ååé‡ã€èƒ½è€—ç­‰å¤šä¸ªç›®æ ‡çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œä½¿ç”¨å¸•ç´¯æ‰˜æœ€ä¼˜è§£åœ¨å¤šä¸ªç›®æ ‡ä¹‹é—´å¯»æ±‚å¹³è¡¡ã€‚</p>
</li>
<li>
<p><strong>è‡ªé€‚åº”è´Ÿè½½å‡è¡¡</strong>ï¼šèƒ½å¤Ÿæ ¹æ®ç¯å¢ƒå˜åŒ–è‡ªåŠ¨è°ƒæ•´å‚æ•°å’Œç­–ç•¥çš„è´Ÿè½½å‡è¡¡ç³»ç»Ÿï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚</p>
</li>
</ol>
<h3 id="è·¨é¢†åŸŸå¯ç¤º">è·¨é¢†åŸŸå¯ç¤º<a class="headerlink" href="#è·¨é¢†åŸŸå¯ç¤º" title="Permanent link">&para;</a></h3>
<p>è´Ÿè½½å‡è¡¡çš„æ€æƒ³å·²ç»è¶…è¶Šäº†è®¡ç®—æœºç½‘ç»œé¢†åŸŸï¼Œå½±å“äº†å¤šä¸ªç›¸å…³å­¦ç§‘ï¼š</p>
<ul>
<li><strong>äº¤é€šæµé‡æ§åˆ¶</strong>ï¼šåŸå¸‚äº¤é€šç®¡ç†ä¸­å€Ÿé‰´äº†è´Ÿè½½å‡è¡¡æ€æƒ³ï¼Œé€šè¿‡åŠ¨æ€è·¯ç”±å¼•å¯¼è½¦è¾†åˆ†æ•£åˆ°ä¸åŒé“è·¯</li>
<li><strong>ç”µåŠ›ç½‘ç»œè°ƒåº¦</strong>ï¼šæ™ºèƒ½ç”µç½‘åˆ©ç”¨ç±»ä¼¼è´Ÿè½½å‡è¡¡çš„ç­–ç•¥å¹³è¡¡å‘ç”µå’Œç”¨ç”µéœ€æ±‚</li>
<li><strong>ä¾›åº”é“¾ç®¡ç†</strong>ï¼šåœ¨å¤šä»“åº“ã€å¤šç‰©æµæ¸ é“é—´ä¼˜åŒ–é…é€è·¯çº¿å’Œèµ„æºåˆ†é…</li>
<li><strong>äº‘è®¡ç®—èµ„æºç®¡ç†</strong>ï¼šè™šæ‹Ÿæœºè¿ç§»å’Œä»»åŠ¡è°ƒåº¦ç®—æ³•ä¸è´Ÿè½½å‡è¡¡æœ‰ç€å…±åŒçš„ç†è®ºåŸºç¡€</li>
</ul>
<p>é€šè¿‡å°†è´Ÿè½½å‡è¡¡ç½®äºæ›´å¹¿æ³›çš„ç†è®ºæ¡†æ¶ä¸­ï¼Œæˆ‘ä»¬ä¸ä»…èƒ½å¤Ÿæ›´æ·±å…¥åœ°ç†è§£ç°æœ‰ç®—æ³•ï¼Œè¿˜èƒ½å¤Ÿæ¢ç´¢å…¨æ–°çš„è§£å†³æ–¹æ¡ˆï¼Œæ¨åŠ¨è´Ÿè½½å‡è¡¡æŠ€æœ¯çš„ä¸æ–­å‘å±•ã€‚</p>
<h2 id="7-æ€»ç»“-">7. æ€»ç»“ ğŸ“<a class="headerlink" href="#7-æ€»ç»“-" title="Permanent link">&para;</a></h2>
<p>è´Ÿè½½å‡è¡¡æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œä¸åŒçš„è´Ÿè½½å‡è¡¡ç®—æ³•é€‚ç”¨äºä¸åŒçš„åœºæ™¯ã€‚æœ¬æ–‡åˆ†æçš„å››ç§ç®—æ³•å„æœ‰ç‰¹ç‚¹ï¼š</p>
<ul>
<li>éšæœºç®—æ³•æœ€ç®€å•é«˜æ•ˆä½†å‡è¡¡æ€§ä¸€èˆ¬</li>
<li>è½®è¯¢ç®—æ³•åˆ†é…æœ€å‡åŒ€ä½†ä¸è€ƒè™‘å®æ—¶è´Ÿè½½</li>
<li>æœ€å°è¿æ¥æœ€èƒ½åæ˜ å®æ—¶è´Ÿè½½ä½†ç»´æŠ¤æˆæœ¬é«˜</li>
<li>Maglevä¸€è‡´æ€§å“ˆå¸Œæä¾›æœ€ä½³ä¸€è‡´æ€§ä¿è¯ä½†å®ç°å¤æ‚</li>
</ul>
<p><strong>å®é™…åº”ç”¨é€‰æ‹©æŒ‡å—</strong>ï¼š</p>
<ul>
<li>å¦‚æœç³»ç»Ÿä¸­è¯·æ±‚å¤„ç†æ—¶é—´ç›¸è¿‘ï¼ŒæœåŠ¡å™¨æ€§èƒ½ä¸€è‡´ï¼Œé€‰æ‹©<strong>éšæœº</strong>æˆ–<strong>è½®è¯¢</strong>ç®—æ³•</li>
<li>å¦‚æœè¯·æ±‚å¤„ç†æ—¶é—´å·®å¼‚å¤§ï¼Œé€‰æ‹©<strong>æœ€å°è¿æ¥</strong>ç®—æ³•</li>
<li>å¦‚æœéœ€è¦ä¿æŒä¼šè¯ä¸€è‡´æ€§æˆ–ç¼“å­˜ä¸€è‡´æ€§ï¼Œé€‰æ‹©<strong>ä¸€è‡´æ€§å“ˆå¸Œ</strong>ç®—æ³•</li>
<li>å¦‚æœç³»ç»Ÿè§„æ¨¡è¾ƒå¤§ä¸”å¯¹æ€§èƒ½è¦æ±‚æé«˜ï¼Œè€ƒè™‘<strong>Maglev</strong>ç®—æ³•</li>
</ul>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œéœ€è¦æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹ã€ç³»ç»Ÿè§„æ¨¡å’Œæ€§èƒ½è¦æ±‚é€‰æ‹©åˆé€‚çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œç”šè‡³å¯èƒ½éœ€è¦è‡ªå®šä¹‰æˆ–ç»„åˆä½¿ç”¨å¤šç§ç®—æ³•æ¥æ»¡è¶³ç‰¹å®šéœ€æ±‚ã€‚Go è¯­è¨€çš„å¹¶å‘ç‰¹æ€§å’Œæ€§èƒ½ä¼˜åŠ¿ä½¿å…¶æˆä¸ºå®ç°é«˜æ•ˆè´Ÿè½½å‡è¡¡å™¨çš„ç†æƒ³é€‰æ‹©ã€‚</p>
<p>æœ€åï¼Œæ— è®ºé€‰æ‹©å“ªç§ç®—æ³•ï¼Œéƒ½åº”è¯¥ç»“åˆå¥åº·æ£€æŸ¥ã€æ•…éšœè½¬ç§»ã€ç›‘æ§å‘Šè­¦ç­‰æœºåˆ¶ï¼Œæ„å»ºä¸€ä¸ªå®Œæ•´çš„è´Ÿè½½å‡è¡¡è§£å†³æ–¹æ¡ˆï¼Œä»¥ç¡®ä¿ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§å’Œå¯é æ€§ã€‚</p>
<hr />
<p>é€šè¿‡æœ¬æ–‡ï¼Œå¸Œæœ›è¯»è€…èƒ½å¤Ÿæ·±å…¥ç†è§£è¿™å‡ ç§è´Ÿè½½å‡è¡¡ç®—æ³•çš„åŸç†å’Œå®ç°ï¼Œåœ¨æ¶æ„è®¾è®¡ä¸­åšå‡ºæ›´æ˜æ™ºçš„é€‰æ‹©ï¼ğŸš€</p>
<h2 id="8-å‚è€ƒ">8. å‚è€ƒ<a class="headerlink" href="#8-å‚è€ƒ" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><a href="https://github.com/catwithtudou/load-balancer-algorithm">Go è´Ÿè½½å‡è¡¡ç®—æ³•å®ç°</a> - æœ¬æ–‡ç®—æ³•çš„Goè¯­è¨€å®ç°æºç </p>
</li>
<li>
<p><a href="https://www.manjusaka.blog/posts/2025/03/23/a-simple-introduction-about-load-balance-algorithm/">A Simple Introduction About Load Balance Algorithm</a> - ç›¸å…³ç®—æ³•ä»‹ç»</p>
</li>
<li>
<p><a href="https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/44824.pdf">Google Maglev Paper</a> - Google Maglevè´Ÿè½½å‡è¡¡å™¨è®ºæ–‡</p>
</li>
<li>
<p><a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#weight">Nginx Weighted Round Robin</a> - Nginxå¹³æ»‘åŠ æƒè½®è¯¢ç®—æ³•è§£é‡Š</p>
</li>
</ol>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="March 24, 2025 11:33:07">March 24, 2025 11:33:07</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="March 24, 2025 11:24:09">March 24, 2025 11:24:09</span>
  </span>

    
    
    
  </aside>


  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../" class="md-footer__link md-footer__link--prev" aria-label="Previous: common">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                common
              </div>
            </div>
          </a>
        
        
          
          <a href="../../../os/" class="md-footer__link md-footer__link--next" aria-label="Next: Operating System">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Operating System
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 catwithtudou
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/catwithtudou" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/catwithtudou" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  


  
    
  



  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="github" checked>
          <span class="task-list-indicator"></span>
          GitHub
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.path", "navigation.prune", "navigation.indexes", "navigation.top", "navigation.footer", "toc.follow", "search.suggest", "search.highlight", "search.share", "content.tabs.link", "content.code.annotation", "content.code.copy", "header.autohide"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>