
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Life">
      
      
        <meta name="author" content="catwithtudou️">
      
      
        <link rel="canonical" href="https://zhengyua.cn/new_blog/architecture/books/2403%E3%80%8A%E9%87%8D%E6%9E%84%EF%BC%9A%E6%94%B9%E5%96%84%E6%97%A2%E6%9C%89%E4%BB%A3%E7%A0%81%E7%9A%84%E8%AE%BE%E8%AE%A1%E3%80%8B/02refactor_part/">
      
      
        <link rel="prev" href="../01refactor/">
      
      
        <link rel="next" href="../../../../middleware/">
      
      
      <link rel="icon" href="../../../../assets/logo.jpeg">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.25">
    
    
      
        <title>07-12 - catwithtudou️🌦️</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-WZVK8HDP5T"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-WZVK8HDP5T",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-WZVK8HDP5T",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#07-12" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="catwithtudou️🌦️" class="md-header__button md-logo" aria-label="catwithtudou️🌦️" data-md-component="logo">
      
  <img src="../../../../assets/logo.jpeg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            catwithtudou️🌦️
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              07-12
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/catwithtudou" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    catwithtudou
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
    
  
  🌦️Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../blog/" class="md-tabs__link">
          
  
    
  
  📌MainPage

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../language/" class="md-tabs__link">
          
  
    
  
  Language

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../algorithms/" class="md-tabs__link">
          
  
    
  
  Algorithms

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../os/" class="md-tabs__link">
          
  
    
  
  OS

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../network/" class="md-tabs__link">
          
  
    
  
  Network

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../ds/" class="md-tabs__link">
          
  
    
  
  DS

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../" class="md-tabs__link">
          
  
    
  
  Architecture

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../middleware/" class="md-tabs__link">
          
  
    
  
  Middleware

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../project/" class="md-tabs__link">
          
  
    
  
  Project

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../common/01-100_tips/" class="md-tabs__link">
          
  
    
  
  Common

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="catwithtudou️🌦️" class="md-nav__button md-logo" aria-label="catwithtudou️🌦️" data-md-component="logo">
      
  <img src="../../../../assets/logo.jpeg" alt="logo">

    </a>
    catwithtudou️🌦️
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/catwithtudou" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    catwithtudou
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🌦️Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../blog/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    📌MainPage
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../language/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Language
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../algorithms/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Algorithms
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../os/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    OS
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../network/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Network
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../ds/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    DS
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    books
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8_2" id="__nav_8_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            books
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2_2" checked>
        
          
          <label class="md-nav__link" for="__nav_8_2_2" id="__nav_8_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    2403《重构：改善既有代码的设计》
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_8_2_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8_2_2">
            <span class="md-nav__icon md-icon"></span>
            2403《重构：改善既有代码的设计》
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01refactor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    01-06
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    07-12
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    07-12
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#7-封装" class="md-nav__link">
    <span class="md-ellipsis">
      7. 封装
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. 封装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-封装记录encapsulate-record" class="md-nav__link">
    <span class="md-ellipsis">
      7.1 封装记录（Encapsulate Record）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-封装集合encapsulate-collection" class="md-nav__link">
    <span class="md-ellipsis">
      7.2 封装集合（Encapsulate Collection）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-以对象取代基本类型replace-primitive-with-object" class="md-nav__link">
    <span class="md-ellipsis">
      7.3 以对象取代基本类型（Replace Primitive with Object）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74-以查询取代临时变量replace-templ-with-query" class="md-nav__link">
    <span class="md-ellipsis">
      7.4 以查询取代临时变量（Replace Templ with Query）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#75-提炼类extract-class" class="md-nav__link">
    <span class="md-ellipsis">
      7.5 提炼类（Extract Class）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#76-内联类inline-class" class="md-nav__link">
    <span class="md-ellipsis">
      7.6 内联类（Inline Class）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#77-隐藏委托关系hide-delegate" class="md-nav__link">
    <span class="md-ellipsis">
      7.7 隐藏委托关系（Hide Delegate）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#78-移除中间人remove-middle-man" class="md-nav__link">
    <span class="md-ellipsis">
      7.8 移除中间人（Remove Middle Man）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#79-替换算法substitute-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      7.9 替换算法（Substitute Algorithm）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-搬移特性" class="md-nav__link">
    <span class="md-ellipsis">
      8. 搬移特性
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-重新组织数据" class="md-nav__link">
    <span class="md-ellipsis">
      9. 重新组织数据
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-简化条件逻辑" class="md-nav__link">
    <span class="md-ellipsis">
      10. 简化条件逻辑
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-重构-api" class="md-nav__link">
    <span class="md-ellipsis">
      11. 重构 API
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-处理继承关系" class="md-nav__link">
    <span class="md-ellipsis">
      12. 处理继承关系
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../middleware/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Middleware
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../project/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Project
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../common/01-100_tips/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Common
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#7-封装" class="md-nav__link">
    <span class="md-ellipsis">
      7. 封装
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. 封装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-封装记录encapsulate-record" class="md-nav__link">
    <span class="md-ellipsis">
      7.1 封装记录（Encapsulate Record）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-封装集合encapsulate-collection" class="md-nav__link">
    <span class="md-ellipsis">
      7.2 封装集合（Encapsulate Collection）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-以对象取代基本类型replace-primitive-with-object" class="md-nav__link">
    <span class="md-ellipsis">
      7.3 以对象取代基本类型（Replace Primitive with Object）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74-以查询取代临时变量replace-templ-with-query" class="md-nav__link">
    <span class="md-ellipsis">
      7.4 以查询取代临时变量（Replace Templ with Query）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#75-提炼类extract-class" class="md-nav__link">
    <span class="md-ellipsis">
      7.5 提炼类（Extract Class）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#76-内联类inline-class" class="md-nav__link">
    <span class="md-ellipsis">
      7.6 内联类（Inline Class）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#77-隐藏委托关系hide-delegate" class="md-nav__link">
    <span class="md-ellipsis">
      7.7 隐藏委托关系（Hide Delegate）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#78-移除中间人remove-middle-man" class="md-nav__link">
    <span class="md-ellipsis">
      7.8 移除中间人（Remove Middle Man）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#79-替换算法substitute-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      7.9 替换算法（Substitute Algorithm）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-搬移特性" class="md-nav__link">
    <span class="md-ellipsis">
      8. 搬移特性
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-重新组织数据" class="md-nav__link">
    <span class="md-ellipsis">
      9. 重新组织数据
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-简化条件逻辑" class="md-nav__link">
    <span class="md-ellipsis">
      10. 简化条件逻辑
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-重构-api" class="md-nav__link">
    <span class="md-ellipsis">
      11. 重构 API
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-处理继承关系" class="md-nav__link">
    <span class="md-ellipsis">
      12. 处理继承关系
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="07-12">07-12<a class="headerlink" href="#07-12" title="Permanent link">&para;</a></h1>
<h2 id="7-封装">7. 封装<a class="headerlink" href="#7-封装" title="Permanent link">&para;</a></h2>
<h3 id="71-封装记录encapsulate-record">7.1 封装记录（Encapsulate Record）<a class="headerlink" href="#71-封装记录encapsulate-record" title="Permanent link">&para;</a></h3>
<p><img alt="" src="https://img.zhengyua.cn/blog/202406040913894.png" /></p>
<ul>
<li><strong>有意义的单元传递</strong></li>
</ul>
<p>记录型结构是多数编程语言提供的一种常见特性。它们能直观地组织起存在关联的数据，让我可以将数据作为有意义的单元传递，而不仅是一堆数据的拼凑。</p>
<ul>
<li><strong>对象可隐藏结构细节和帮助字段改名</strong></li>
</ul>
<p>对象可以隐藏其内部结构细节，隐藏结构的细节。该对象的用户不必追究存储的细节和计算的过程。同时这种封装还有助于字段的改名：可重新命名字段，但同时提供新老字段名的访问方法，这样可以渐进地修改调用方，直到替换全部完成。</p>
<ul>
<li><strong>数据结构直观</strong></li>
</ul>
<p>若这种记录只在程序的一个小范围里使用，那问题还不大，但若其使用范围变宽，“数据结构不直观”这个问题就会造成更多困扰。可以重构它，使其变得更直观——但如果真需要这样做，那还不如使用类来得直接。</p>
<ul>
<li><strong>嵌套结构也值得封装</strong></li>
</ul>
<p>程序中间常常需要互相传递嵌套的列表或散列映射结构，这些数据结构后续经常需要被序列化成JSON或XML。这样的嵌套结构同样值得封装，这样如果后续其结构需要变更或者需要修改记录内的值，封装能够帮更好地应对变化。</p>
<details class="note">
<summary>具体重构步骤</summary>
<ol>
<li>对持有记录的变量使用封装变量，将其封装到一个函数中；</li>
</ol>
<blockquote>
<p>记得为这个函数取一个容易搜索的名字。</p>
</blockquote>
<ol start="2">
<li>
<p>创建一个类，将记录包装起来，并将记录变量的值替换为该类的一个实例。然后在类上定义一个访问函数，用于返回原始的记录。修改封装变量的函数，令其使用这个访问函数；</p>
</li>
<li>
<p>测试;</p>
</li>
<li>
<p>新建一个函数，让它返回该类的对象，而非那条原始的记录；</p>
</li>
<li>
<p>对于该记录的每处使用点，将原先返回记录的函数调用替换为那个返回实例对象的函数调用。使用对象上的访问函数来获取数据的字段，如果该字段的访问函数还不存在，那就创建一个。每次更改之后运行测试；</p>
</li>
</ol>
<blockquote>
<p>如果该记录比较复杂，例如是个嵌套解构，那么先重点关注客户端对数据的更新操作，对于读取操作可以考虑返回一个数据副本或只读的数据代理。</p>
</blockquote>
<ol start="6">
<li>
<p>移除类对原始记录的访问函数，那个容易搜索的返回原始数据的函数也要一并删除；</p>
</li>
<li>
<p>测试；</p>
</li>
<li>
<p>如果记录中的字段本身也是复杂结构，考虑对其再次应用封装记录或封装集合手法；</p>
</li>
</ol>
</details>
<h3 id="72-封装集合encapsulate-collection">7.2 封装集合（Encapsulate Collection）<a class="headerlink" href="#72-封装集合encapsulate-collection" title="Permanent link">&para;</a></h3>
<p><img alt="" src="https://img.zhengyua.cn/blog/202406040919805.png" /></p>
<ul>
<li><strong>清晰观测数据修改</strong></li>
</ul>
<p>封装程序中的所有可变数据可以让我们容易看清楚数据被修改的地点和修改方式，这样需要更改数据结构时就非常方便。</p>
<ul>
<li><strong>只对集合变量访问封装的问题</strong></li>
</ul>
<p>封装集合时人们常常犯一个错误即只对集合变量的访问进行了封装，但依然让取值函数返回集合本身。这使得集合的成员变量可以直接被修改，而封装它的类则全然不知，无法介入。</p>
<ul>
<li><strong>注意集合取值函数返回</strong></li>
</ul>
<p>更好的做法是，不要让集合的取值函数返回原始集合，这就避免了客户端的意外修改。</p>
<ul>
<li><strong>直接返回集合值的问题</strong></li>
</ul>
<p>一种避免直接修改集合的方法是，永远不直接返回集合的值。这种方法提倡，不要直接使用集合的字段，而是通过定义类上的方法来代替。</p>
<p>增加使用特殊的类方法来处理这些场景，会增加许多额外代码，使集合操作容易组合的特性大打折扣。</p>
<ul>
<li><strong>限制集合的访问权</strong></li>
</ul>
<p>以某种形式限制集合的访问权，只允许对集合进行读操作。</p>
<ul>
<li><strong>提供取值函数</strong></li>
</ul>
<p>最常见的做法是，为集合提供一个取值函数，但令其返回一个集合的副本。这样即使有人修改了副本，被封装的集合也不会受到影响。</p>
<ul>
<li><strong>保持一致</strong></li>
</ul>
<p>采用哪种方法并无定式，最重要的是在同个代码库中做法要保持一致。建议只用一种方案，这样每个人都能很快习惯它，并在每次调用集合的访问函数时期望相同的行为。</p>
<details class="note">
<summary>具体重构步骤</summary>
<ol>
<li>
<p>如果集合的引用尚未被封装起来，先用封装变量封装它；</p>
</li>
<li>
<p>在类上添加用于“添加集合元素”和“移除集合元素”的函数；</p>
</li>
</ol>
<blockquote>
<p>如果存在对该集合的设值函数，尽可能先用移除设值函数移除它。如果不能移除该设值函数，至少让它返回集合的一份副本。</p>
</blockquote>
<ol start="3">
<li>
<p>执行静态检查；</p>
</li>
<li>
<p>查找集合的引用点。如果有调用者直接修改集合，令该处调用使用新的添加/移除元素的函数。每次修改后执行测试；</p>
</li>
<li>
<p>修改集合的取值函数，使其返回一份只读的数据，可以使用只读代理或数据副本；</p>
</li>
<li>
<p>测试；</p>
</li>
</ol>
</details>
<h3 id="73-以对象取代基本类型replace-primitive-with-object">7.3 以对象取代基本类型（Replace Primitive with Object）<a class="headerlink" href="#73-以对象取代基本类型replace-primitive-with-object" title="Permanent link">&para;</a></h3>
<p><img alt="" src="https://img.zhengyua.cn/blog/202406040936656.png" /></p>
<ul>
<li><strong>数据操作拓展</strong></li>
</ul>
<p>一旦发现对某个数据的操作不仅仅局限于打印时，我就会为它创建一个新类。一开始这个类也许只是简单包装一下简单类型的数据，不过只要类有了，日后添加的业务逻辑就有地可去了。</p>
<details class="note">
<summary>具体重构步骤</summary>
<ol>
<li>
<p>如果变量尚未被封装起来，先使用封装变量封装它；</p>
</li>
<li>
<p>为这个数据值创建一个简单的类。类的构造函数应该保存这个数据值，并为它提供一个取值函数；</p>
</li>
<li>
<p>执行静态检查；</p>
</li>
<li>
<p>修改第一步得到的设值函数，令其创建一个新类的对象并将其存入字段，如果有必要的话，同时修改字段的类型声明；</p>
</li>
<li>
<p>修改取值函数，令其调用新类的取值函数，并返回结果；</p>
</li>
<li>
<p>测试；</p>
</li>
<li>
<p>考虑对第一步得到的访问函数使用函数改名，以便更好反映其用途；</p>
</li>
<li>
<p>考虑应用将引用对象改为值对象或将值对象改为引用对象，明确指出新对象的角色是值对象还是引用对象；</p>
</li>
</ol>
</details>
<h3 id="74-以查询取代临时变量replace-templ-with-query">7.4 以查询取代临时变量（Replace Templ with Query）<a class="headerlink" href="#74-以查询取代临时变量replace-templ-with-query" title="Permanent link">&para;</a></h3>
<p><img alt="" src="https://img.zhengyua.cn/blog/202406040940191.png" /></p>
<ul>
<li><strong>设立清晰的边界</strong></li>
</ul>
<p>如果正在分解一个冗长的函数，那么将变量抽取到函数里能使函数的分解过程更简单，因为这样就不再需要将变量作为参数传递给提炼出来的小函数。</p>
<p>将变量的计算逻辑放到函数中，也有助于在提炼得到的函数与原函数之间设立清晰的边界，这能帮助发现并避免难缠的依赖及副作用。</p>
<ul>
<li><strong>避免重复编写计算逻辑</strong></li>
</ul>
<p>改用函数还可以避免了在多个函数中重复编写计算逻辑。每当在不同的地方看见同一段变量的计算逻辑，可以尝试将它们挪到同一个函数里。</p>
<ul>
<li><strong>快照用途的临时变量</strong></li>
</ul>
<p>最简单的情况是，这个临时变量只被赋值一次，但在更复杂的代码片段里，变量也可能被多次赋值——此时应该将这些计算代码一并提炼到查询函数中。并且，待提炼的逻辑多次计算同样的变量时，应该能得到相同的结果。因此，对于那些做快照用途的临时变量（从变量名往往可见端倪）就不能使用本手法。</p>
<details class="note">
<summary>具体重构步骤</summary>
<ol>
<li>
<p>检查变量在使用前是否已经完全计算完毕，检查计算它的那段代码是否每次都能得到一样的值；</p>
</li>
<li>
<p>如果变量目前不是只读的，但是可以改造成只读变量，那就先改造它；</p>
</li>
<li>
<p>测试；</p>
</li>
<li>
<p>将为变量赋值的代码段提炼成函数；</p>
</li>
</ol>
<blockquote>
<p>如果变量和函数不能使用同样的名字，那么先为函数取个临时的名字。确保待提炼函数没有副作用。若有先应用将查询函数和修改函数分离手法隔离副作用。</p>
</blockquote>
<ol start="5">
<li>
<p>测试；</p>
</li>
<li>
<p>应用内联变量手法移除临时变量；</p>
</li>
</ol>
</details>
<h3 id="75-提炼类extract-class">7.5 提炼类（Extract Class）<a class="headerlink" href="#75-提炼类extract-class" title="Permanent link">&para;</a></h3>
<p><img alt="" src="https://img.zhengyua.cn/blog/202406040950654.png" /></p>
<ul>
<li><strong>类不断成长扩展</strong></li>
</ul>
<p>在实际工作中，类会不断成长扩展。随着责任不断增加，这个类会变得过分复杂。</p>
<ul>
<li><strong>大类的维护</strong></li>
</ul>
<p>维护大量函数和数据的的类往往因为太大而不易理解。此时需要考虑哪些部分可以分离出去，并将它们分离到一个独立的类中。</p>
<p>如果某些数据和某些函数总是一起出现，某些数据经常同时变化甚至彼此相依，这就表示你应该将它们分离出去。</p>
<ul>
<li><strong>类的子类化</strong></li>
</ul>
<p>如果发现子类化只影响类的部分特性，或发现某些特性需要以一种方式来子类化，某些特性则需要以另一种方式子类化，这就意味着需要分解原来的类。</p>
<details class="note">
<summary>具体重构步骤</summary>
<ol>
<li>
<p>决定如何分解类所负的责任；</p>
</li>
<li>
<p>创建一个新的类，用以表现从旧类中分离出来的责任；</p>
</li>
</ol>
<blockquote>
<p>如果旧类剩下的责任与旧类的名称不符，为旧类改名。</p>
</blockquote>
<ol start="3">
<li>
<p>构造旧类时创建一个新类的实例，建立“从旧类访问新类”的连接关系；</p>
</li>
<li>
<p>对于你想搬移的每一个字段，运用搬移字段搬移之。每次更改后运行测试；</p>
</li>
<li>
<p>使用搬移函数将必要函数搬移到新类。先搬移较低层函数。每次更改后运行测试；</p>
</li>
<li>
<p>检查两个类的接口，去掉不再需要的函数，必要时为函数重新取一个适合新环境的名字；</p>
</li>
<li>
<p>决定是否公开新的类。如果确实需要，考虑对新类应用将引用对象改为值对象使其成为一个值对象；</p>
</li>
</ol>
</details>
<h3 id="76-内联类inline-class">7.6 内联类（Inline Class）<a class="headerlink" href="#76-内联类inline-class" title="Permanent link">&para;</a></h3>
<p><img alt="" src="https://img.zhengyua.cn/blog/202406040955411.png" /></p>
<ul>
<li><strong>不承担责任的类</strong></li>
</ul>
<p>内联类正好与提炼类相反。如果一个类不再承担足够责任，不再有单独存在的理由（这通常是因为此前的重构动作移走了这个类的责任）。</p>
<ul>
<li><strong>重新安排职责</strong></li>
</ul>
<p>若想重新安排两个类的职责，并让它们产生关联。此时先将它们内联成一个类再用提炼类去分离其职责会更加简单。</p>
<details class="note">
<summary>具体重构步骤</summary>
<ol>
<li>
<p>对于待内联类（源类）中的所有public函数，在目标类上创建一个对应的函数，新创建的所有函数应该直接委托至源类；</p>
</li>
<li>
<p>修改源类public方法的所有引用点，令它们调用目标类对应的委托方法。每次更改后运行测试；</p>
</li>
<li>
<p>将源类中的函数与数据全部搬移到目标类，每次修改之后进行测试，直到源类 变成空壳为止；</p>
</li>
<li>
<p>删除源类，为它举行一个简单的“丧礼”；</p>
</li>
</ol>
</details>
<h3 id="77-隐藏委托关系hide-delegate">7.7 隐藏委托关系（Hide Delegate）<a class="headerlink" href="#77-隐藏委托关系hide-delegate" title="Permanent link">&para;</a></h3>
<p><img alt="" src="https://img.zhengyua.cn/blog/202406051019653.png" /></p>
<ul>
<li><strong>好的模块化设计</strong></li>
</ul>
<p>一个好的模块化的设计，“封装”即使不是其最关键特征，也是最关键特征之一。“封装”意味着每个模块都应该尽可能少了解系统的其他部分。</p>
<ul>
<li><strong>去除委托依赖</strong></li>
</ul>
<p>如果某些客户端先通过服务对象的字段得到另一个对象（受托类），然后调用后者的函数，那么客户就必须知晓这一层委托关系。 万一受托类修改了接口，变化会波及通过服务对象使用它的所有客户端。</p>
<p>可以在服务对象上放置一个简单的委托函数，将委托关系隐藏起来，从而去除这种依赖。这么一来，即使将来委托关系发生变化，变化也只会影响服务对象，而不会直接波及所有客户端。</p>
<p><img alt="" src="https://img.zhengyua.cn/blog/202406051021566.png" /></p>
<details class="note">
<summary>具体重构步骤</summary>
<ol>
<li>
<p>对于每个委托关系中的函数，在服务对象端建立一个简单的委托函数；</p>
</li>
<li>
<p>调整客户端，令它只调用服务对象提供的函数。每次调整后运行测；</p>
</li>
<li>
<p>如果将来不再有任何客户端需要取用 Delegate（受托类），便可移除服务对象 中的相关访问函数。</p>
</li>
<li>
<p>测试；</p>
</li>
</ol>
</details>
<h3 id="78-移除中间人remove-middle-man">7.8 移除中间人（Remove Middle Man）<a class="headerlink" href="#78-移除中间人remove-middle-man" title="Permanent link">&para;</a></h3>
<p><img alt="" src="https://img.zhengyua.cn/blog/202406051023383.png" /></p>
<ul>
<li><strong>封装的代价</strong></li>
</ul>
<p>每当客户端要使用受托类的新特性时，就必须在服务端添加一个简单委托函数。随着受托类的特性越来越多，更多的转发函数会让服务类完全变成了一个中间人，此时就应该让客户直接调用受托类。</p>
<ul>
<li><strong>合适的隐藏程度</strong></li>
</ul>
<p>随着代码的变化，“合适的隐藏程度”这个尺度也相应改变。</p>
<details class="note">
<summary>具体重构步骤</summary>
<ol>
<li>
<p>为受托对象创建一个取值函数；</p>
</li>
<li>
<p>对于每个委托函数，让其客户端转为连续的访问函数调用。每次替换后运行测试；</p>
</li>
</ol>
<blockquote>
<p>替换完委托方法的所有调用点后，就可以删掉这个委托方法了。</p>
<p>这能通过可自动化的重构手法来完成，你可以先对受托字段使用封装变量，再应用内联函数内联所有使用它的函数。</p>
</blockquote>
</details>
<h3 id="79-替换算法substitute-algorithm">7.9 替换算法（Substitute Algorithm）<a class="headerlink" href="#79-替换算法substitute-algorithm" title="Permanent link">&para;</a></h3>
<p><img alt="" src="https://img.zhengyua.cn/blog/202406051027265.png" /></p>
<ul>
<li><strong>更简单的解决方案</strong></li>
</ul>
<p>随着对问题有了更多理解，可能会发现在原先的做法之外，有更简单的解决方案，此时就需要改变原先的算法。</p>
<ul>
<li><strong>替换算法的困难</strong></li>
</ul>
<p>替换一个巨大且复杂的算法是非常困难的，只有先将它分解为较简单的小型函数，才能很有把握地进行算法替换工作。</p>
<details class="note">
<summary>具体重构步骤</summary>
<ol>
<li>
<p>整理一下待替换的算法，保证它已经被抽取到一个独立的函数中；</p>
</li>
<li>
<p>先只为这个函数准备测试，以便固定它的行为；</p>
</li>
<li>
<p>准备好另一个（替换用）算法；</p>
</li>
<li>
<p>执行静态检查；</p>
</li>
<li>
<p>运行测试，比对新旧算法的运行结果。如果测试通过，那就大功告成；否则在后续测试和调试过程中，以旧算法为比较参照标准；</p>
</li>
</ol>
</details>
<h2 id="8-搬移特性">8. 搬移特性<a class="headerlink" href="#8-搬移特性" title="Permanent link">&para;</a></h2>
<h2 id="9-重新组织数据">9. 重新组织数据<a class="headerlink" href="#9-重新组织数据" title="Permanent link">&para;</a></h2>
<h2 id="10-简化条件逻辑">10. 简化条件逻辑<a class="headerlink" href="#10-简化条件逻辑" title="Permanent link">&para;</a></h2>
<h2 id="11-重构-api">11. 重构 API<a class="headerlink" href="#11-重构-api" title="Permanent link">&para;</a></h2>
<h2 id="12-处理继承关系">12. 处理继承关系<a class="headerlink" href="#12-处理继承关系" title="Permanent link">&para;</a></h2>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">June 5, 2024 10:30:02</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">June 4, 2024 09:57:00</span>
  </span>

    
    
    
  </aside>


  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../01refactor/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 01-06">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                01-06
              </div>
            </div>
          </a>
        
        
          
          <a href="../../../../middleware/" class="md-footer__link md-footer__link--next" aria-label="Next: Middleware">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Middleware
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 catwithtudou
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/catwithtudou" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/catwithtudou" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9L389.2 48zm-24.8 373.8h39.1L151.1 88h-42l255.3 333.8z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  


  
    
  



  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="github" checked>
          <span class="task-list-indicator"></span>
          GitHub
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.path", "navigation.prune", "navigation.indexes", "navigation.top", "navigation.footer", "toc.follow", "search.suggest", "search.highlight", "search.share", "content.tabs.link", "content.code.annotation", "content.code.copy", "header.autohide"], "search": "../../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.081f42fc.min.js"></script>
      
        <script src="../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>